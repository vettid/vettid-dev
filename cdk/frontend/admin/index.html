<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta http-equiv="X-Content-Type-Options" content="nosniff" />
  <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
  <title>VettID ‚Ä¢ Admin</title>
  <link rel="icon" type="image/jpeg" href="https://vettid.dev/assets/favicon.ico" />
  <!-- Self-hosted fonts -->
  <link rel="stylesheet" href="https://vettid.dev/assets/fonts.css" />
  <link rel="stylesheet" href="https://vettid.dev/assets/styles.css" />
  <link rel="stylesheet" href="/vendor/flatpickr/flatpickr.min.css" />
  <link rel="stylesheet" href="/vendor/flatpickr/dark.css" />
  <style>

    /* ===== CSS Custom Properties for Theme Support ===== */
    :root {
      /* Background colors - Warm dark palette */
      --bg-input: #0d0c0a;
      --bg-card: #12110f;
      --bg-hover: #1f1d1a;
      --bg-tertiary: #1a1816;
      --bg-progress: #2a2622;
      --bg-error-bg: #1c0a0a;
      --bg-button-secondary: #4c4663;
      --bg-button-disabled: #3a3835;
      --bg-logs: #0a0908;
      --bg-divider: #2a2622;
      --bg-header: linear-gradient(135deg,#1a1816 0%,#12110f 100%);
      --bg-table-header: linear-gradient(135deg,#12110f 0%,#0d0c0a 100%);
      --bg-bulk-action: linear-gradient(135deg,#1a1816 0%,#12110f 100%);
      --bg-dropdown: linear-gradient(135deg,#1a1816 0%,#12110f 100%);
      --bg-sidebar: linear-gradient(180deg,#14120f 0%,#0a0908 100%);
      /* Skeleton loader gradient */
      --bg-skeleton: linear-gradient(90deg,#12110f 25%,#1a1816 50%,#12110f 75%);

      /* Motion */
      --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
      --duration-fast: 150ms;
      --duration-normal: 200ms;
      --duration-slow: 300ms;
    }

    /* Light theme overrides - Warm light palette */
    [data-theme="light"] {
      /* Background colors */
      --bg-input: #fafaf9;
      --bg-card: #ffffff;
      --bg-hover: #f5f5f4;
      --bg-tertiary: #e7e5e4;
      --bg-progress: #d6d3d1;
      --bg-error-bg: #fef2f2;
      --bg-button-secondary: #7c3aed;
      --bg-button-disabled: #d6d3d1;
      --bg-logs: #f5f5f4;
      --bg-divider: #d6d3d1;
      --bg-table-header: linear-gradient(135deg,#ffffff 0%,#fafaf9 100%);
      --bg-bulk-action: linear-gradient(135deg,#ffffff 0%,#fafaf9 100%);
      --bg-dropdown: linear-gradient(135deg,#ffffff 0%,#fafaf9 100%);
      --bg-sidebar: linear-gradient(180deg,#fafaf9 0%,#f5f5f4 100%);
      /* Skeleton loader gradient for light theme */
      --bg-skeleton: linear-gradient(90deg,#e7e5e4 25%,#f5f5f4 50%,#e7e5e4 75%);
    }

    *{box-sizing:border-box;}
    body{display:flex;flex-direction:column;height:100vh;margin:0;overflow:hidden;}
    header{display:flex;justify-content:space-between;align-items:center;padding:16px 24px;background:var(--bg-header);border-bottom:2px solid var(--accent);box-shadow:0 2px 8px rgba(0,0,0,0.3);flex-shrink:0;}
    .main-container{display:flex;flex:1;overflow:hidden;}
    .sidebar{width:220px;background:var(--bg-sidebar);border-right:2px solid #222;display:flex;flex-direction:column;overflow-y:auto;transition:width 0.3s ease;position:relative;flex-shrink:0;}
    .sidebar.collapsed{width:0;overflow:hidden;border-right:none;}
    .sidebar-toggle{position:fixed;top:50%;left:220px;transform:translateY(-50%);background:var(--accent);border:none;width:32px;height:48px;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.3);color:#000;font-size:1.2rem;font-weight:bold;border-radius:0 4px 4px 0;z-index:1000;display:flex;align-items:center;justify-content:center;transition:left 0.3s ease;}
    .sidebar.collapsed ~ .sidebar-toggle{left:0;border-radius:4px 0 0 4px;}
    .wrap{padding:20px 32px;flex:1;overflow-y:auto;max-width:none;width:100%;}
    input,select,textarea{padding:.6rem;border-radius:2px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);transition:border 0.2s}
    input:focus,select:focus,textarea:focus{outline:none;border-color:var(--accent)}
    table{width:100%;border-collapse:collapse;table-layout:auto;}
    th{padding:12px 10px;border-bottom:2px solid var(--accent);text-align:left;color:var(--accent);text-transform:uppercase;font-size:0.85rem;letter-spacing:0.5px;background:var(--bg-table-header)}
    td{padding:10px;border-bottom:1px solid var(--border);text-align:left}
    tbody tr:hover{background:var(--bg-hover)}
    .admin-only{display:flex;overflow:hidden;}
    .error{background:var(--bg-error-bg);border:2px solid #dc2626;color:#fecaca;padding:18px;border-radius:4px;margin-bottom:20px;box-shadow:0 4px 12px rgba(220,38,38,0.2)}
    .tabs{display:flex;flex-direction:column;gap:0;padding:12px 0;}
    .tab{background:none;color:var(--gray);border:none;padding:14px 20px;cursor:pointer;transition:all .2s;border-left:3px solid transparent;text-align:left;font-weight:600;font-size:0.9rem;width:100%;}
    .tab:hover{color:var(--text);background:rgba(255,193,37,0.08)}
    .tab.active{color:var(--accent);border-left-color:var(--accent);background:rgba(255,193,37,0.12)}
    .tab-parent{position:relative;display:flex;justify-content:space-between;align-items:center;}
    .tab-parent .tab-text{flex:1;}
    .tab-parent .tab-chevron{transition:transform 0.2s ease;font-size:0.8rem;margin-right:4px;}
    .tab-parent.expanded .tab-chevron{transform:rotate(90deg);}
    .tab-children{max-height:0;overflow:hidden;transition:max-height 0.3s ease;background:rgba(0,0,0,0.3);}
    .tab-children.expanded{max-height:400px;}
    .tab-child{padding-left:36px;font-size:0.85rem;min-height:44px;display:flex;align-items:center;}
    .tab-child:hover{background:rgba(255,193,37,0.06);}
    .tab-child.active{color:var(--accent);border-left-color:var(--accent);background:rgba(255,193,37,0.1);}
    .sub-tab-content{display:none;}
    .sub-tab-content.active{display:block;}
    .tab-content{display:none;height:100%;width:100%;}
    .tab-content.active{display:block;width:100%;}
    @media(max-width:768px){
      .tab-child{min-height:48px;padding:16px 20px 16px 40px;}
      .tab-parent{min-height:48px;padding:16px 20px;}
      .tab-children.expanded{max-height:300px;}
    }
    .user-dropdown{position:relative;display:inline-block;}
    .user-dropdown-btn{cursor:pointer;display:flex;align-items:center;gap:6px;padding:6px 12px;border-radius:6px;transition:background 0.2s;}
    .user-dropdown-btn:hover{background:rgba(255,193,37,0.1);}
    .user-dropdown-menu{display:none;position:absolute;top:100%;right:0;margin-top:8px;background:var(--bg-header);border:2px solid var(--accent);border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,0.4);min-width:200px;z-index:1000;}
    .user-dropdown-menu.active{display:block;}
    .user-dropdown-item{display:block;width:100%;padding:12px 16px;cursor:pointer;transition:background 0.2s;border-bottom:1px solid var(--bg-divider);color:var(--text);font-size:0.9rem;}
    .user-dropdown-item:last-child{border-bottom:none;}
    .user-dropdown-item:hover{background:rgba(255,193,37,0.1);}
    .pagination{display:flex;align-items:center;gap:12px;margin-top:20px;padding:12px;background:var(--bg-input);border-radius:2px;border:1px solid var(--border);flex-wrap:wrap;justify-content:center;}
    .pagination select{width:auto;padding:.5rem}
    .pagination button{padding:.5rem 1rem;font-size:.85rem}
    .pagination .info{color:var(--gray);text-align:center;}
    .toast-container{position:fixed;top:80px;right:24px;z-index:9999;display:flex;flex-direction:column;gap:12px;max-width:400px;}
    .toast{padding:16px 20px;border-radius:8px;box-shadow:0 4px 16px rgba(0,0,0,0.4);display:flex;align-items:center;gap:12px;animation:slideIn 0.3s ease-out;font-weight:500;border-left:4px solid;}
    .toast.success{background:linear-gradient(135deg,#0e5f3d 0%,#064e2f 100%);border-left-color:#10b981;color:#d1fae5;}
    .toast.error{background:linear-gradient(135deg,#7f1d1d 0%,#5f1515 100%);border-left-color:#ef4444;color:#fecaca;}
    .toast.info{background:linear-gradient(135deg,#1e3a8a 0%,#1e40af 100%);border-left-color:#3b82f6;color:#dbeafe;}
    .toast.warning{background:linear-gradient(135deg,#78350f 0%,#92400e 100%);border-left-color:#f59e0b;color:#fef3c7;}
    @keyframes slideIn{from{transform:translateX(400px);opacity:0;}to{transform:translateX(0);opacity:1;}}
    @keyframes slideOut{from{transform:translateX(0);opacity:1;}to{transform:translateX(400px);opacity:0;}}
    .toast.removing{animation:slideOut 0.3s ease-in;}
    .empty-state{text-align:center;padding:60px 20px;color:var(--gray);}
    .empty-state-icon{font-size:4rem;margin-bottom:16px;opacity:0.5;}
    .empty-state-text{font-size:1.1rem;margin-bottom:8px;}
    .empty-state-subtext{font-size:0.9rem;opacity:0.7;}
    .progress-bar{background:var(--bg-progress);border-radius:4px;height:8px;overflow:hidden;position:relative;}
    .progress-bar-fill{height:100%;border-radius:4px;transition:width 0.3s ease;}
    .skeleton{background:var(--bg-skeleton);background-size:200% 100%;animation:shimmer 1.5s infinite;}
    @keyframes shimmer{0%{background-position:200% 0;}100%{background-position:-200% 0;}}
    .proposal-filter{opacity:0.7;transition:all 0.2s;}
    .proposal-filter.active{opacity:1 !important;box-shadow:0 4px 12px rgba(255,193,37,0.4) !important;transform:scale(1.02);border:2px solid var(--accent) !important;}
    .subscription-type-filter.active{opacity:1 !important;box-shadow:0 4px 12px rgba(255,193,37,0.4) !important;transform:scale(1.02);border:2px solid var(--accent) !important;}
    .filter-active{opacity:1 !important;box-shadow:0 4px 12px rgba(255,193,37,0.4) !important;transform:scale(1.02);border:2px solid var(--accent) !important;}
    .waitlist-filter.active{opacity:1 !important;box-shadow:0 4px 12px rgba(255,193,37,0.4) !important;transform:scale(1.02);border:2px solid var(--accent) !important;}
    .modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:10000;display:none;align-items:center;justify-content:center;}
    .modal-overlay.active{display:flex;}
    .modal{background:var(--bg-card);border:2px solid var(--accent);border-radius:8px;padding:24px;max-width:500px;width:90%;box-shadow:0 8px 32px rgba(0,0,0,0.6);}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;border-bottom:1px solid var(--border);padding-bottom:12px;}
    .modal-title{font-size:1.2rem;font-weight:700;color:var(--accent);}
    .modal-close{background:none;border:none;color:var(--gray);font-size:1.5rem;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;transition:color 0.2s;}
    .modal-close:hover{color:var(--text);}
    .modal-body{margin-bottom:20px;}
    .modal-option{padding:12px;margin-bottom:8px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;cursor:pointer;transition:all 0.2s;}
    .modal-option:hover{border-color:var(--accent);background:var(--bg-hover);}
    .modal-option-title{font-weight:600;margin-bottom:4px;}
    .modal-option-desc{font-size:0.85rem;color:var(--gray);}
    .bulk-action-bar{display:none;position:sticky;top:0;z-index:100;background:var(--bg-header);border:2px solid var(--accent);border-radius:4px;padding:12px 16px;margin-bottom:16px;align-items:center;gap:12px;box-shadow:0 4px 12px rgba(255,193,37,0.3);}
    .bulk-action-bar.active{display:flex;}
    .bulk-action-bar .count{color:var(--accent);font-weight:600;margin-right:auto;}
    .bulk-action-bar button{font-size:0.8rem;padding:6px 14px;}
    th.sortable{cursor:pointer;user-select:none;position:relative;}
    th.sortable:hover{background:rgba(255,193,37,0.1);}
    th.sortable:after{content:'‚Üï';margin-left:6px;opacity:0.3;font-size:0.8rem;}
    th.sortable.asc:after{content:'‚Üë';opacity:1;}
    th.sortable.desc:after{content:'‚Üì';opacity:1;}
    mark{background:#f59e0b;color:#000;padding:2px 4px;border-radius:2px;font-weight:600;}
    .toast button{background:rgba(255,255,255,0.2);border:none;color:inherit;padding:6px 12px;border-radius:4px;cursor:pointer;font-weight:600;margin-left:8px;transition:background 0.2s;}
    .toast button:hover{background:rgba(255,255,255,0.3);}
    .btn:disabled{opacity:0.5;cursor:not-allowed;background:var(--bg-button-disabled) !important;}
    .password-strength{margin-top:8px;height:4px;background:var(--bg-progress);border-radius:2px;overflow:hidden;}
    .password-strength-fill{height:100%;transition:width 0.3s,background 0.3s;}
    .password-strength-text{font-size:0.75rem;margin-top:4px;font-weight:600;}
    .password-match-indicator{font-size:0.8rem;margin-top:6px;font-weight:600;}
    .password-match{color:#10b981;}
    .password-no-match{color:#ef4444;}
    .strength-weak{background:#ef4444;}.strength-fair{background:#f59e0b;}.strength-good{background:#10b981;}.strength-strong{background:#059669;}
    .theme-toggle{background:none;border:2px solid var(--border);color:var(--text);border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s;font-size:1.2rem;}
    .theme-toggle:hover{border-color:var(--accent);background:rgba(255,193,37,0.1);transform:rotate(180deg);}
    /* Action dropdown for table rows */
    .action-dropdown{position:relative;display:inline-block;}
    .action-dropdown-btn{background:var(--bg-input);border:1px solid var(--border);color:var(--text);width:32px;height:32px;border-radius:6px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:1.2rem;font-weight:bold;transition:all 0.2s;letter-spacing:1px;}
    .action-dropdown-btn:hover{border-color:var(--accent);background:rgba(255,193,37,0.1);}
    .action-dropdown-menu{display:none;position:absolute;top:100%;right:0;margin-top:4px;background:var(--bg-dropdown);border:1px solid var(--accent);border-radius:6px;box-shadow:0 4px 16px rgba(0,0,0,0.4);min-width:160px;z-index:1000;overflow:hidden;}
    .action-dropdown-menu.active{display:block;}
    .action-dropdown-item{display:block;width:100%;padding:10px 14px;cursor:pointer;transition:background 0.2s;border:none;background:none;color:var(--text);font-size:0.85rem;text-align:left;}
    .action-dropdown-item:hover{background:rgba(255,193,37,0.1);}
    [data-theme="light"] .action-dropdown-btn{background:#f9fafb;border-color:#d1d5db;color:#1f2937;}
    [data-theme="light"] .action-dropdown-btn:hover{border-color:#d4a012;background:rgba(212,160,18,0.1);}
    [data-theme="light"] .action-dropdown-menu{background:#ffffff;border-color:#d4a012;box-shadow:0 4px 16px rgba(0,0,0,0.15);}
    [data-theme="light"] .action-dropdown-item{color:#1f2937;}
    [data-theme="light"] .action-dropdown-item:hover{background:rgba(212,160,18,0.1);}
    /* Responsive view: cards on mobile, table on desktop */
    .card-grid{display:none;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-top:16px;}
    .list-view{display:block;}
    @media(max-width:768px){
      .card-grid{display:grid;}
      .list-view{display:none!important;}
    }
    @media(min-width:769px){
      .card-grid{display:none!important;}
      .list-view{display:block;}
    }
    /* Responsive tile grids - single column on mobile */
    .tile-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;width:100%;}
    @media(max-width:768px){
      .tile-grid{grid-template-columns:1fr!important;}
    }
    .data-card{background:var(--card-bg);border:1px solid var(--border);border-radius:6px;padding:16px;transition:all 0.2s;cursor:pointer;}
    .data-card:hover{border-color:var(--accent);box-shadow:0 4px 12px rgba(255,193,37,0.2);transform:translateY(-2px);}
    .data-card-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--border);}
    .data-card-title{font-weight:700;color:var(--accent);font-size:1rem;line-height:1.3;}
    .data-card-badge{background:var(--accent);color:#000;padding:4px 8px;border-radius:4px;font-size:0.7rem;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;}
    .data-card-body{display:flex;flex-direction:column;gap:8px;}
    .data-card-row{display:flex;justify-content:space-between;font-size:0.85rem;}
    .data-card-label{color:var(--gray);font-weight:600;}
    .data-card-value{color:var(--text);text-align:right;word-break:break-word;}
    .data-card-actions{display:flex;gap:8px;margin-top:12px;padding-top:12px;border-top:1px solid var(--border);}
    .data-card-actions .btn{flex:1;font-size:0.75rem;padding:6px 10px;}
    table.hide-on-card{display:table;}
    table.hide-on-card.hidden{display:none;}
    @media(max-width:768px){
      body{height:auto!important;min-height:100vh;overflow:auto!important;}
      .sidebar{position:fixed;left:0;top:60px;bottom:0;z-index:999;box-shadow:2px 0 8px rgba(0,0,0,0.3);}
      .main-container{flex-direction:column;overflow:visible;min-height:calc(100vh - 60px);}
      .wrap{padding:16px;padding-bottom:100px;overflow:visible;-webkit-overflow-scrolling:touch;min-height:0;flex:1;}
      .tab-content{height:auto!important;overflow:visible!important;}
      .sub-tab-content{height:auto!important;overflow:visible!important;}
      .tab-content.card{overflow:visible!important;}
      .user-dropdown-menu{right:auto;left:0;}
      /* Mobile pagination styles */
      .pagination{flex-direction:column;gap:10px;padding:16px;}
      .pagination label{width:100%;text-align:center;}
      .pagination .info{width:100%;order:1;}
      .pagination button{min-width:100px;}
      /* Mobile modal styles */
      .modal{width:95%;max-width:95%;padding:16px;max-height:90vh;overflow-y:auto;}
      .modal-header{margin-bottom:16px;padding-bottom:10px;}
      .modal-title{font-size:1.1rem;}
      .modal-body{margin-bottom:16px;font-size:0.9rem;}
      .modal-option{padding:10px;}
      .modal-option-title{font-size:0.95rem;}
      .modal-option-desc{font-size:0.8rem;}
    }

    /* Comprehensive light theme overrides for admin portal */
    [data-theme="light"] {
      --bg-header: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
      --bg-sidebar: linear-gradient(180deg, #ffffff 0%, #f5f5f5 100%);
      --bg-dropdown: #ffffff;
    }
    [data-theme="light"] body { background: #f5f5f5; color: #1f2937; }
    [data-theme="light"] header { background: var(--bg-header); border-bottom-color: #d4a012; }
    [data-theme="light"] header h1 { color: #1f2937; }
    [data-theme="light"] .sidebar { background: var(--bg-sidebar); border-right-color: #d1d5db; }
    [data-theme="light"] .tab { color: #4b5563; }
    [data-theme="light"] .tab:hover { color: #1f2937; background: rgba(212,160,18,0.08); }
    [data-theme="light"] .tab.active { color: #b8860b; background: rgba(212,160,18,0.15); border-left-color: #d4a012; }
    [data-theme="light"] .tab-children { background: rgba(0,0,0,0.02); }
    [data-theme="light"] .tab-child:hover { background: rgba(212,160,18,0.06); }
    [data-theme="light"] .tab-child.active { color: #b8860b; background: rgba(212,160,18,0.12); border-left-color: #d4a012; }
    [data-theme="light"] .wrap { background: #f5f5f5; }
    [data-theme="light"] .card, [data-theme="light"] .tab-content.card { background: #ffffff; color: #1f2937; border-color: #d1d5db; }
    [data-theme="light"] h1, [data-theme="light"] h2, [data-theme="light"] h3, [data-theme="light"] h4 { color: #1f2937; }
    [data-theme="light"] p, [data-theme="light"] span, [data-theme="light"] label { color: #4b5563; }
    [data-theme="light"] input, [data-theme="light"] select, [data-theme="light"] textarea { background: #f9fafb; color: #1f2937; border-color: #d1d5db; }
    [data-theme="light"] table th { background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%); color: #b8860b; border-bottom-color: #d4a012; }
    [data-theme="light"] table td { border-bottom-color: #d1d5db; color: #1f2937; }
    [data-theme="light"] tbody tr:hover { background: #f3f4f6; }
    [data-theme="light"] .user-dropdown-menu { background: #ffffff; border-color: #d4a012; box-shadow: 0 4px 16px rgba(0,0,0,0.15); }
    [data-theme="light"] .user-dropdown-item { color: #1f2937; border-bottom-color: #d1d5db; }
    [data-theme="light"] .user-dropdown-item:hover { background: rgba(212,160,18,0.1); }
    [data-theme="light"] .user-dropdown-btn span { color: #b8860b !important; }
    [data-theme="light"] #userEmail { color: #b8860b !important; }
    [data-theme="light"] #userAdminType { color: #4b5563 !important; }
    [data-theme="light"] .modal { background: #ffffff; }
    [data-theme="light"] .modal-header { border-bottom-color: #d1d5db; }
    [data-theme="light"] .modal-title { color: #b8860b; }
    [data-theme="light"] .modal-body { color: #4b5563; }
    [data-theme="light"] .modal-option { background: #f9fafb; border-color: #d1d5db; }
    [data-theme="light"] .modal-option:hover { background: #f3f4f6; border-color: #d4a012; }
    [data-theme="light"] .pagination { background: #f9fafb; border-color: #d1d5db; }
    [data-theme="light"] .pagination .info { color: #4b5563; }
    [data-theme="light"] .error { background: #fee2e2; border-color: #dc2626; color: #991b1b; }
    [data-theme="light"] .skeleton { background: linear-gradient(90deg,#e5e7eb 25%,#f3f4f6 50%,#e5e7eb 75%); background-size: 200% 100%; }
    [data-theme="light"] .sidebar-toggle { background: #d4a012; color: #000; }
    [data-theme="light"] code { background: #e5e7eb; color: #1f2937; }
    [data-theme="light"] .bulk-action-bar { background: #ffffff; border-color: #d4a012; }

    /* Flatpickr light theme overrides - use html selector for specificity */
    html[data-theme="light"] .flatpickr-calendar { background: #ffffff !important; border: 1px solid #d1d5db !important; box-shadow: 0 4px 16px rgba(0,0,0,0.15) !important; }
    html[data-theme="light"] .flatpickr-calendar.arrowTop:before { border-bottom-color: #d1d5db !important; }
    html[data-theme="light"] .flatpickr-calendar.arrowTop:after { border-bottom-color: #ffffff !important; }
    html[data-theme="light"] .flatpickr-months { background: linear-gradient(135deg, #d4a012 0%, #b8860b 100%) !important; border-bottom: 1px solid #b8860b !important; }
    html[data-theme="light"] .flatpickr-months .flatpickr-month { color: #000 !important; }
    html[data-theme="light"] .flatpickr-current-month .flatpickr-monthDropdown-months { background: transparent !important; color: #000 !important; font-weight: 600 !important; }
    html[data-theme="light"] .flatpickr-current-month .flatpickr-monthDropdown-months option { background: #ffffff !important; color: #1f2937 !important; }
    html[data-theme="light"] .flatpickr-current-month input.cur-year { color: #000 !important; background: transparent !important; font-weight: 600 !important; }
    html[data-theme="light"] .flatpickr-months .flatpickr-prev-month, html[data-theme="light"] .flatpickr-months .flatpickr-next-month { color: #000 !important; fill: #000 !important; }
    html[data-theme="light"] .flatpickr-months .flatpickr-prev-month:hover, html[data-theme="light"] .flatpickr-months .flatpickr-next-month:hover { color: #fff !important; }
    html[data-theme="light"] .flatpickr-months .flatpickr-prev-month:hover svg, html[data-theme="light"] .flatpickr-months .flatpickr-next-month:hover svg { fill: #fff !important; }
    html[data-theme="light"] .flatpickr-months .flatpickr-prev-month svg, html[data-theme="light"] .flatpickr-months .flatpickr-next-month svg { fill: #000 !important; }
    html[data-theme="light"] .flatpickr-weekdays { background: #f9fafb !important; }
    html[data-theme="light"] span.flatpickr-weekday { color: #6b7280 !important; background: transparent !important; }
    html[data-theme="light"] .flatpickr-days { background: #ffffff !important; }
    html[data-theme="light"] .flatpickr-day { color: #1f2937 !important; background: transparent !important; }
    html[data-theme="light"] .flatpickr-day:hover { background: #f3f4f6 !important; border-color: #d1d5db !important; }
    html[data-theme="light"] .flatpickr-day.today { border-color: #d4a012 !important; }
    html[data-theme="light"] .flatpickr-day.selected, html[data-theme="light"] .flatpickr-day.selected:hover { background: #d4a012 !important; border-color: #d4a012 !important; color: #000 !important; }
    html[data-theme="light"] .flatpickr-day.prevMonthDay, html[data-theme="light"] .flatpickr-day.nextMonthDay { color: #9ca3af !important; }
    html[data-theme="light"] .flatpickr-day.disabled, html[data-theme="light"] .flatpickr-day.disabled:hover { color: #d1d5db !important; }
    html[data-theme="light"] .flatpickr-time { background: #f9fafb !important; border-top: 1px solid #e5e7eb !important; }
    html[data-theme="light"] .flatpickr-time input { color: #1f2937 !important; background: #ffffff !important; border: 1px solid #d1d5db !important; }
    html[data-theme="light"] .flatpickr-time input:hover, html[data-theme="light"] .flatpickr-time input:focus { background: #ffffff !important; border-color: #d4a012 !important; }
    html[data-theme="light"] .flatpickr-time .flatpickr-time-separator, html[data-theme="light"] .flatpickr-time .flatpickr-am-pm { color: #1f2937 !important; }
    html[data-theme="light"] .flatpickr-time .flatpickr-am-pm:hover { background: #f3f4f6 !important; }
    html[data-theme="light"] .numInputWrapper span { border-color: #d1d5db !important; }
    html[data-theme="light"] .numInputWrapper span:hover { background: #f3f4f6 !important; }
    html[data-theme="light"] .numInputWrapper span svg path { fill: #6b7280 !important; }
    html[data-theme="light"] .numInputWrapper span:hover svg path { fill: #1f2937 !important; }

    /* Light theme comprehensive inline style overrides */
    /* Secondary buttons (background:#333) */
    [data-theme="light"] button[style*="background:#333"],
    [data-theme="light"] .btn[style*="background:#333"] { background: #e5e7eb !important; color: #1f2937 !important; }
    [data-theme="light"] button[style*="background:#333"]:hover,
    [data-theme="light"] .btn[style*="background:#333"]:hover { background: #d1d5db !important; }
    /* Card-like containers */
    [data-theme="light"] div[style*="background:var(--bg-card)"],
    [data-theme="light"] div[style*="background:var(--bg-card)"],
    [data-theme="light"] div[style*="background:#050505"] { background: var(--bg-card) !important; }
    /* Modal backgrounds */
    [data-theme="light"] div[style*="background:var(--bg-card)"] { background: var(--bg-card) !important; }
    /* Input fields */
    [data-theme="light"] input[style*="background:var(--bg-card)"],
    [data-theme="light"] textarea[style*="background:var(--bg-card)"] { background: var(--bg-input) !important; color: #1f2937 !important; }
    /* Borders */
    [data-theme="light"] *[style*="border:1px solid var(--border)"],
    [data-theme="light"] *[style*="border:2px solid #222"],
    [data-theme="light"] *[style*="border:1px solid var(--border)"] { border-color: #d1d5db !important; }
    [data-theme="light"] *[style*="border-top:1px solid var(--border)"],
    [data-theme="light"] *[style*="border-top:2px solid #222"],
    [data-theme="light"] *[style*="border-top:1px solid #333"] { border-top-color: #d1d5db !important; }
    [data-theme="light"] *[style*="border-bottom:1px solid var(--border)"],
    [data-theme="light"] *[style*="border-bottom:2px solid #222"],
    [data-theme="light"] *[style*="border-bottom:1px solid #333"] { border-bottom-color: #d1d5db !important; }
    /* Progress bar backgrounds */
    [data-theme="light"] div[style*="background:#222"] { background: #e5e7eb !important; }
    /* Toast light theme */
    [data-theme="light"] .toast.success { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); color: #065f46; border-left-color: #10b981; }
    [data-theme="light"] .toast.error { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); color: #991b1b; border-left-color: #ef4444; }
    [data-theme="light"] .toast.info { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); color: #1e40af; border-left-color: #3b82f6; }
    [data-theme="light"] .toast.warning { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); color: #92400e; border-left-color: #f59e0b; }
  </style>
</head>
<body>
  <div id="toastContainer" class="toast-container"></div>

  <!-- Password Change Modal -->
  <div id="passwordModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Change Password</div>
        <button class="modal-close" id="closePasswordModal">√ó</button>
      </div>
      <div class="modal-body">
        <div style="margin-bottom:16px;">
          <label for="currentPassword" style="display:block;margin-bottom:6px;font-size:0.9rem;color:var(--gray);">Current Password</label>
          <input type="password" id="currentPassword" placeholder="Enter current password" style="width:100%;" autocomplete="current-password" />
        </div>
        <div style="margin-bottom:16px;">
          <label for="newPassword" style="display:block;margin-bottom:6px;font-size:0.9rem;color:var(--gray);">New Password</label>
          <input type="password" id="newPassword" placeholder="Enter new password" style="width:100%;" autocomplete="new-password" />
          <div class="password-strength">
            <div class="password-strength-fill" id="passwordStrengthFill"></div>
          </div>
          <div class="password-strength-text" id="passwordStrengthText"></div>
        </div>
        <div style="margin-bottom:20px;">
          <label for="confirmPassword" style="display:block;margin-bottom:6px;font-size:0.9rem;color:var(--gray);">Confirm New Password</label>
          <input type="password" id="confirmPassword" placeholder="Confirm new password" style="width:100%;" autocomplete="new-password" />
          <div class="password-match-indicator" id="passwordMatchIndicator"></div>
        </div>
        <div style="display:flex;gap:12px;">
          <button class="btn" id="submitPasswordChange" style="flex:1;">Change Password</button>
          <button class="btn" id="cancelPasswordChange" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MFA Status Modal -->
  <div id="mfaModal" class="modal-overlay">
    <div class="modal" style="max-width:450px;">
      <div class="modal-header">
        <div class="modal-title">Two-Factor Authentication</div>
        <button class="modal-close" id="closeMfaModal">√ó</button>
      </div>
      <div class="modal-body">
        <!-- MFA enabled state -->
        <div id="mfaEnabled" style="display:none;">
          <div style="text-align:center;padding:20px;">
            <div style="font-size:3rem;margin-bottom:16px;">‚úì</div>
            <p style="color:#10b981;font-weight:600;font-size:1.1rem;margin-bottom:8px;">MFA is enabled</p>
            <p style="color:var(--gray);font-size:0.9rem;">Your account is protected with two-factor authentication.</p>
          </div>
        </div>
        <!-- MFA not enabled state -->
        <div id="mfaNotEnabled" style="display:none;">
          <div style="text-align:center;padding:20px;">
            <div style="font-size:3rem;margin-bottom:16px;">üîê</div>
            <p style="font-weight:600;font-size:1.1rem;margin-bottom:12px;">MFA not configured</p>
            <p style="color:var(--gray);font-size:0.9rem;margin-bottom:16px;">
              To set up MFA, please sign out and sign back in. You will be prompted to configure your authenticator app during the sign-in process.
            </p>
            <button class="btn" id="mfaSignOutBtn" style="width:100%;">Sign Out to Set Up MFA</button>
          </div>
        </div>
        <!-- Loading state -->
        <div id="mfaLoading" style="text-align:center;padding:40px;">
          <p style="color:var(--gray);">Checking MFA status...</p>
        </div>
        <div id="mfaError" style="display:none;color:#ef4444;background:var(--bg-error-bg);padding:12px;border-radius:4px;margin-top:12px;font-size:0.9rem;"></div>
      </div>
    </div>
  </div>

  <!-- Custom Invite Message Modal -->
  <div id="customMessageModal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title">Send Invitations</div>
        <button class="modal-close" id="closeCustomMessageModal">√ó</button>
      </div>
      <div class="modal-body">
        <p style="margin-bottom:16px;color:var(--gray);font-size:0.9rem;">
          Sending invites to <strong id="inviteCountDisplay">0</strong> waitlist entries.
        </p>
        <div style="margin-bottom:20px;">
          <label for="customMessageText" style="display:block;margin-bottom:6px;font-size:0.9rem;color:var(--gray);">
            Custom Message (Optional)
          </label>
          <textarea id="customMessageText"
                    placeholder="Add a personal message to include in the invitation email (optional)..."
                    style="width:100%;min-height:100px;resize:vertical;"></textarea>
          <div style="font-size:0.8rem;color:var(--gray);margin-top:4px;">
            This message will be included in the invitation email sent to each recipient.
          </div>
        </div>
        <div style="display:flex;gap:12px;">
          <button class="btn" id="confirmSendInvites" style="flex:1;background:linear-gradient(135deg,#0e9e4d 0%,#0a7a3a 100%);">Send Invites</button>
          <button class="btn" id="cancelSendInvites" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
        </div>
      </div>
    </div>
  </div>


  <header>
    <h1 style="display:flex;align-items:center;gap:12px;">
      <img src="https://vettid.dev/assets/logo.jpg" alt="VettID Logo" style="height:36px;width:36px;border-radius:6px;" />
      Admin
    </h1>
    <div style="display:flex;align-items:center;gap:16px;">
      <div id="userDropdownContainer" class="user-dropdown" style="display:none;">
        <div class="user-dropdown-btn">
          <span id="userEmail" style="color:var(--accent);font-weight:600;"></span>
          <span id="userAdminType"></span>
          <span style="font-size:0.7rem;">‚ñº</span>
        </div>
        <div id="userDropdownMenu" class="user-dropdown-menu">
          <div class="user-dropdown-item" id="changePasswordBtn">
            Change Password
          </div>
          <div class="user-dropdown-item" id="setupMfaBtn" style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
            <span>Set up MFA</span>
            <span id="mfaStatusIcon" style="font-size:0.9rem;"></span>
          </div>
          <div class="user-dropdown-item" id="themeToggle" style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
            <span>Theme</span>
            <span id="themeIcon" style="font-size:1.1rem;">‚òÄÔ∏è</span>
          </div>
          <div class="user-dropdown-item" id="signout">
            Sign Out
          </div>
        </div>
      </div>
      <button id="signin" class="btn">Sign in</button>
    </div>
  </header>

  <div class="main-container">
    <div class="admin-only">
      <div class="sidebar" id="sidebar">
        <div class="tabs">
          <button class="tab active" data-tab="waitlist">Waitlist</button>
          <button class="tab" data-tab="users">Users</button>
          <button class="tab tab-parent" id="subscribersParent" data-tab="subscriptions">
            <span class="tab-text">Subscribers</span>
            <span class="tab-chevron">‚ñ∏</span>
          </button>
          <div class="tab-children" id="subscribersChildren">
            <button class="tab tab-child" data-tab="subscriptions" data-sub-tab="subscriber-management">Subscriber Management</button>
            <button class="tab tab-child" data-tab="subscriptions" data-sub-tab="subscription-analytics">Subscription Analytics</button>
          </div>
          <button class="tab" data-tab="invites">Invites</button>
          <button class="tab tab-parent" id="voteManagementParent" data-tab="vote-management">
            <span class="tab-text">Vote Management</span>
            <span class="tab-chevron">‚ñ∏</span>
          </button>
          <div class="tab-children" id="voteManagementChildren">
            <button class="tab tab-child" data-tab="vote-management" data-sub-tab="in-progress">In-Progress</button>
            <button class="tab tab-child" data-tab="vote-management" data-sub-tab="completed">Completed</button>
          </div>
          <button class="tab tab-parent" id="siteManagementParent" data-tab="site-management">
            <span class="tab-text">Site Management</span>
            <span class="tab-chevron">‚ñ∏</span>
          </button>
          <div class="tab-children" id="siteManagementChildren">
            <button class="tab tab-child" data-tab="site-management" data-sub-tab="system-health">System Health</button>
            <button class="tab tab-child" data-tab="site-management" data-sub-tab="event-handlers">Event Handlers</button>
            <button class="tab tab-child" data-tab="site-management" data-sub-tab="supported-services">Supported Services</button>
            <button class="tab tab-child" data-tab="site-management" data-sub-tab="subscription-types">Subscription Types</button>
            <button class="tab tab-child" data-tab="site-management" data-sub-tab="membership-terms">Membership Terms</button>
            <button class="tab tab-child" data-tab="site-management" data-sub-tab="email">Email</button>
          </div>
          <button class="tab tab-parent" id="adminParent" data-tab="admin">
            <span class="tab-text">Admin</span>
            <span class="tab-chevron">‚ñ∏</span>
          </button>
          <div class="tab-children" id="adminChildren">
            <button class="tab tab-child" data-tab="admin" data-sub-tab="admin-users">Admin Users</button>
            <button class="tab tab-child" data-tab="admin" data-sub-tab="notifications">Notifications</button>
          </div>
        </div>
      </div>
      <button class="sidebar-toggle" id="sidebarToggle">&lt;</button>
    </div>

    <div class="wrap">
      <div id="notAdminError" class="error" style="display:none">
        <strong>Access Denied</strong><br>
        You are not authorized to access this page. Admin privileges are required.
      </div>

      <div class="admin-only">

      <div id="waitlist" class="tab-content card active">
        <h3 style="margin-top:0;">Waitlist Management</h3>

        <!-- Quick Filter Badges -->
        <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
          <button id="quickFilterPending" class="btn waitlist-filter active" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:10px 20px;font-weight:600;">
            Pending <span id="pendingWaitlistCount" style="background:#1e40af;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterInvited" class="btn waitlist-filter" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
            Invited <span id="invitedWaitlistCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterRejected" class="btn waitlist-filter" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);padding:10px 20px;font-weight:600;">
            Rejected <span id="rejectedWaitlistCount" style="background:#991b1b;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
        </div>

        <!-- Filters and Search -->
        <div style="padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;">
            <div>
              <label for="waitlistSearch" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Search</label>
              <input id="waitlistSearch" type="text" placeholder="Name, email..." style="width:100%;" />
            </div>
            <button id="resetWaitlistFilters" class="btn" style="margin-top:20px;background:var(--bg-button-secondary);">Reset Filters</button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div style="margin-bottom:16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap;">
          <button id="refreshWaitlist" class="btn">Refresh</button>
          <button id="batchImportBtn" class="btn" style="background:linear-gradient(135deg,#8b5cf6 0%,#7c3aed 100%);" data-action="openCsvImportModal">Batch Import</button>
          <button id="sendInvitesBtn" class="btn" style="background:linear-gradient(135deg,#0e9e4d 0%,#0a7a3a 100%);" disabled>Invite</button>
          <button id="inviteAllPendingBtn" class="btn" style="background:linear-gradient(135deg,#0891b2 0%,#0e7490 100%);">Invite All Pending</button>
          <button id="rejectWaitlistBtn" class="btn" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);" disabled>Reject</button>
          <button id="deleteWaitlistBtn" class="btn" style="background:linear-gradient(135deg,#7f1d1d 0%,#450a0a 100%);" disabled>Delete</button>
          <span id="selectedWaitlistCount" style="color:var(--gray);margin-left:auto;"></span>
        </div>

        <!-- Waitlist Table (desktop) -->
        <div id="waitlistTableContainer" class="list-view">
          <table id="waitlistTable">
            <thead>
              <tr>
                <th><input type="checkbox" id="selectAllWaitlist" /></th>
                <th>Name</th>
                <th>Email</th>
                <th>Status</th>
                <th>Created</th>
                <th>Invited</th>
                <th>Invited By</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Waitlist Cards (mobile) -->
        <div id="waitlistCardContainer" class="card-grid"></div>

        <!-- Pagination -->
        <div class="pagination">
          <label>Show: <select id="waitlistPerPage"><option value="10" selected>10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></label>
          <button id="waitlistPrev" class="btn">Previous</button>
          <span class="info" id="waitlistInfo"></span>
          <button id="waitlistNext" class="btn">Next</button>
        </div>
      </div>

      <div id="users" class="tab-content card">
        <h3 style="margin-top:0;">User Management</h3>

        <!-- Quick Filter Badges -->
        <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
          <button id="quickFilterAction" class="btn filter-active" style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);padding:10px 20px;font-weight:600;position:relative;">
            Pending <span id="actionCount" style="background:#dc2626;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterRegistered" class="btn" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
            Registered <span id="registeredCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterDisabled" class="btn" style="background:linear-gradient(135deg,#ec4899 0%,#be185d 100%);padding:10px 20px;font-weight:600;">
            Disabled <span id="disabledCount" style="background:#9f1239;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterInvited" class="btn" style="background:linear-gradient(135deg,#6366f1 0%,#4f46e5 100%);padding:10px 20px;font-weight:600;">
            Invited <span id="invitedCount" style="background:#312e81;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
        </div>

        <!-- Advanced Filters -->
        <div style="padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
          <h4 style="margin:0 0 12px 0;color:var(--accent);">Filters</h4>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:12px;">
            <div>
              <label for="filterRegistration" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Registration Status</label>
              <select id="filterRegistration" style="width:100%;">
                <option value="">All</option>
                <option value="pending">Pending</option>
                <option value="approved">Approved</option>
                <option value="rejected">Rejected</option>
                <option value="disabled">Disabled</option>
                <option value="deleted">Deleted</option>
              </select>
            </div>
            <div>
              <label for="filterMembership" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Membership Status</label>
              <select id="filterMembership" style="width:100%;">
                <option value="">All</option>
                <option value="none">No Request</option>
                <option value="pending">Pending</option>
                <option value="approved">Member</option>
                <option value="denied">Denied</option>
              </select>
            </div>
            <div>
              <label for="filterSubscription" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Subscription Status</label>
              <select id="filterSubscription" style="width:100%;">
                <option value="">All</option>
                <option value="active">Active</option>
                <option value="cancelled">Cancelled</option>
                <option value="expired">Expired</option>
                <option value="none">No Subscription</option>
              </select>
            </div>
          </div>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:12px;">
            <div>
              <label for="filterDateFrom" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Registration Date From</label>
              <input id="filterDateFrom" type="text" placeholder="From date" style="width:100%;" />
            </div>
            <div>
              <label for="filterDateTo" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Registration Date To</label>
              <input id="filterDateTo" type="text" placeholder="To date" style="width:100%;" />
            </div>
            <div>
              <label for="filterLastActive" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Last Active</label>
              <select id="filterLastActive" style="width:100%;">
                <option value="">All Time</option>
                <option value="1">Last 24 Hours</option>
                <option value="7">Last 7 Days</option>
                <option value="30">Last 30 Days</option>
                <option value="90">Last 90 Days</option>
                <option value="inactive-30">Inactive 30+ Days</option>
                <option value="inactive-90">Inactive 90+ Days</option>
              </select>
            </div>
          </div>
          <div style="display:flex;gap:12px;align-items:center;">
            <div style="flex:1;">
              <label for="usersSearch" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Search</label>
              <input id="usersSearch" type="text" placeholder="Name, email, invite code, user GUID..." style="width:100%;" />
            </div>
            <button id="resetFilters" class="btn" style="margin-top:20px;background:var(--bg-button-secondary);">Reset Filters</button>
          </div>
        </div>

        <!-- Action Buttons -->
        <div style="margin-bottom:16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
          <button id="refreshUsers" class="btn">Refresh</button>
          <button id="bulkApproveReg" class="btn" style="background:linear-gradient(135deg,#0e9e4d 0%,#0a7a3a 100%);" disabled>Approve</button>
          <button id="bulkRejectReg" class="btn" style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);" disabled>Reject</button>
          <button id="bulkDisableUsers" class="btn" style="background:linear-gradient(135deg,#ec3024 0%,#c4271e 100%);" disabled>Disable</button>
          <button id="bulkEnableUsers" class="btn" style="background:linear-gradient(135deg,#0e9e4d 0%,#0a7a3a 100%);" disabled>Enable</button>
          <button id="bulkDeleteUsers" class="btn" style="background:linear-gradient(135deg,#7f1d1d 0%,#450a0a 100%);" disabled>Delete</button>
          <span id="usersBulkCount" style="color:var(--gray);width:100%;margin-top:4px;"></span>
        </div>

        <!-- Users Table (desktop) -->
        <div id="usersTableContainer" class="list-view">
          <table id="usersTable">
            <thead>
              <tr>
                <th><input type="checkbox" id="selectAllUsers" /></th>
                <th class="sortable" data-column="first_name" data-list="users">Name</th>
                <th class="sortable" data-column="email" data-list="users">Email</th>
                <th class="sortable" data-column="status" data-list="users">Status</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <!-- Users Cards (mobile) -->
        <div id="usersCardContainer" class="card-grid"></div>

        <!-- Pagination -->
        <div class="pagination">
          <label>Show: <select id="usersPerPage"><option value="10" selected>10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></label>
          <button id="usersPrev" class="btn">Previous</button>
          <span class="info" id="usersInfo"></span>
          <button id="usersNext" class="btn">Next</button>
        </div>
      </div>

      <div id="invites" class="tab-content card">
        <button id="toggleInviteForm" class="btn" style="margin-bottom:16px;">Create Invite</button>
        <h3>All invites</h3>

        <!-- Quick Stats Badges -->
        <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
          <button id="quickFilterActiveInvites" class="btn filter-active" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
            Active <span id="activeInvitesCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterExpiringSoonInvites" class="btn" style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);padding:10px 20px;font-weight:600;">
            Expiring Soon <span id="expiringSoonInvitesCount" style="background:#92400e;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
          <button id="quickFilterUsedInvites" class="btn" style="background:linear-gradient(135deg,#a855f7 0%,#7c3aed 100%);padding:10px 20px;font-weight:600;">
            Used <span id="usedInvitesCount" style="background:#5b21b6;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
          </button>
        </div>

        <button id="refreshInvites" class="btn">Refresh</button>
        <label style="margin-left:16px;">Search: <input id="invitesSearch" type="text" placeholder="Invite code..." style="width:200px" /></label>
        <div style="margin-top:16px;">
          <button id="bulkExpireInvites" class="btn" style="background:linear-gradient(135deg,#ec3024 0%,#c4271e 100%);box-shadow:0 4px 14px rgba(236,48,36,0.5);">Expire Selected</button>
          <button id="bulkDeleteInvites" class="btn" style="background:linear-gradient(135deg,#6b3a7d 0%,#552e64 100%);margin-left:8px;box-shadow:0 4px 14px rgba(107,58,125,0.5);">Delete Selected</button>
          <span id="invitesSelectedCount" style="margin-left:16px;opacity:.7;"></span>
        </div>
        <div id="invitesTableContainer" class="list-view">
          <table id="invitesTable">
            <thead><tr><th><input type="checkbox" id="selectAllInvites" /></th><th>Code</th><th>Sent To</th><th>Progress</th><th>Status</th><th>Auto-Approve</th><th>Created</th><th>Created By</th><th>Expires</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="invitesCardContainer" class="card-grid"></div>
        <div class="pagination">
          <label>Show: <select id="invitesPerPage"><option value="10" selected>10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></label>
          <button id="invitesPrev" class="btn">Previous</button>
          <span class="info" id="invitesInfo"></span>
          <button id="invitesNext" class="btn">Next</button>
        </div>
      </div>

      <div id="admin" class="tab-content card">
        <!-- Admin Users Sub-Tab -->
        <div id="admin-users" class="sub-tab-content active">
          <h3 style="margin-top:0;">Admin Users</h3>
          <p class="muted">Manage administrator accounts and permissions.</p>

          <!-- Invite Admin User Button -->
          <button id="toggleAdminForm" class="btn" style="margin-bottom:16px;background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%);">Invite Admin User</button>

          <!-- Pending Admin Invitations Section -->
          <div id="pendingAdminsSection" style="margin-bottom:24px;display:none;">
            <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
              <h4 style="margin:0;color:var(--accent);">Pending Invitations</h4>
              <span id="pendingAdminsCount" style="background:#f59e0b;color:#fff;border-radius:12px;padding:2px 10px;font-size:0.8rem;font-weight:600;">0</span>
            </div>
            <p style="color:var(--gray);font-size:0.85rem;margin-bottom:12px;">Admins awaiting email verification. They must click the verification link before their account can be activated.</p>
            <div id="pendingAdminsList" style="display:grid;gap:12px;">
              <!-- Pending admin cards will be dynamically added here -->
            </div>
          </div>

          <!-- Add Admin User Form (Hidden by default) -->

          <!-- Quick Filter Badges -->
          <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
            <button id="quickFilterActiveAdmins" class="btn filter-active" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
              Active <span id="activeAdminsCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button id="quickFilterDisabledAdmins" class="btn" style="background:linear-gradient(135deg,#f97316 0%,#ea580c 100%);padding:10px 20px;font-weight:600;">
              Disabled <span id="disabledAdminsCount" style="background:#c2410c;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
          </div>

          <!-- Search and Bulk Actions -->
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:12px;">
            <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
              <button id="refreshAdmins" class="btn">Refresh</button>
              <label style="display:flex;align-items:center;gap:8px;">
                Search:
                <input id="adminsSearch" type="text" placeholder="Name or email..." style="width:250px" />
              </label>
            </div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
              <button id="bulkDisableAdmins" class="btn" style="background:linear-gradient(135deg,#ec3024 0%,#c4271e 100%);" disabled>Disable</button>
              <button id="bulkEnableAdmins" class="btn" style="background:linear-gradient(135deg,#0e9e4d 0%,#0a7a3a 100%);" disabled>Enable</button>
              <span id="adminsBulkCount" style="color:var(--gray);"></span>
            </div>
          </div>

          <div id="adminsTableContainer" class="list-view">
            <table id="adminsTable">
              <thead>
                <tr>
                  <th><input type="checkbox" id="selectAllAdmins" /></th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Admin Type</th>
                  <th>Status</th>
                  <th>Last Login</th>
                  <th>Created At</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="adminsCardContainer" class="card-grid"></div>
          <div class="pagination">
            <label>Show: <select id="adminsPerPage"><option value="10" selected>10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></label>
            <button id="adminsPrev" class="btn">Previous</button>
            <span class="info" id="adminsInfo"></span>
            <button id="adminsNext" class="btn">Next</button>
          </div>
        </div>

        <!-- Notifications Sub-Tab -->
        <div id="notifications" class="sub-tab-content">
          <h3 style="margin-top:0;">Notifications</h3>
          <p class="muted">Manage email notification assignments for administrators.</p>

          <!-- Waitlist Notifications -->
          <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
            <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:1.1rem;">Waitlist Notifications</h4>
            <p style="margin:0 0 16px 0;color:var(--gray);font-size:0.9rem;">Notified when someone registers for the waitlist</p>

            <div id="waitlistNotificationsList" style="margin-bottom:12px;">
              <!-- Assigned admins will be listed here -->
            </div>

            <button id="addWaitlistNotification" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:8px 16px;font-size:0.9rem;">Add Admin</button>
          </div>

          <!-- User Notifications -->
          <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
            <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:1.1rem;">User Notifications</h4>
            <p style="margin:0 0 16px 0;color:var(--gray);font-size:0.9rem;">Notified when a user registration needs approval</p>

            <div id="userNotificationsList" style="margin-bottom:12px;">
              <!-- Assigned admins will be listed here -->
            </div>

            <button id="addUserNotification" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:8px 16px;font-size:0.9rem;">Add Admin</button>
          </div>

          <!-- Vote Notifications -->
          <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
            <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:1.1rem;">Vote Notifications</h4>
            <p style="margin:0 0 16px 0;color:var(--gray);font-size:0.9rem;">Notified when a vote closes, containing the results</p>

            <div id="voteNotificationsList" style="margin-bottom:12px;">
              <!-- Assigned admins will be listed here -->
            </div>

            <button id="addVoteNotification" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:8px 16px;font-size:0.9rem;">Add Admin</button>
          </div>

          <!-- System Health Notifications -->
          <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
            <h4 style="margin:0 0 8px 0;color:var(--accent);font-size:1.1rem;">System Health Notifications</h4>
            <p style="margin:0 0 16px 0;color:var(--gray);font-size:0.9rem;">Notified when a system health issue is identified</p>

            <div id="system_healthNotificationsList" style="margin-bottom:12px;">
              <!-- Assigned admins will be listed here -->
            </div>

            <button id="addSystemHealthNotification" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:8px 16px;font-size:0.9rem;">Add Admin</button>
          </div>
        </div>
      </div>

      <div id="site-management" class="tab-content card">
        <!-- System Health Sub-Tab -->
        <div id="system-health" class="sub-tab-content active">
          <h3 style="margin-top:0;">System Health</h3>
          <p class="muted">Monitor system resources and performance metrics.</p>

          <div style="display:flex;justify-content:flex-end;margin-bottom:20px;">
            <button id="refreshSystemHealth" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:8px 16px;">Refresh</button>
          </div>

          <!-- Health Metrics Grid -->
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:16px;margin-bottom:24px;">
            <!-- SES Quota Card -->
            <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                <div style="width:40px;height:40px;background:linear-gradient(135deg,#10b981 0%,#059669 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;">üìß</div>
                <div>
                  <h4 style="margin:0;font-size:0.9rem;color:var(--accent);">SES Sending Quota</h4>
                  <div style="font-size:0.7rem;color:var(--gray);margin-top:2px;">24-hour sending limit</div>
                </div>
              </div>
              <div id="sesQuotaUsed" style="font-size:1.8rem;font-weight:700;color:#10b981;margin-bottom:4px;">‚Äî</div>
              <div id="sesQuotaLimit" style="font-size:0.8rem;color:var(--gray);">of ‚Äî emails sent today</div>
              <div id="sesQuotaBar" style="margin-top:12px;height:6px;background:var(--bg-tertiary);border-radius:3px;overflow:hidden;">
                <div style="height:100%;width:0%;background:linear-gradient(90deg,#10b981,#059669);transition:width 0.3s;"></div>
              </div>
            </div>

            <!-- DynamoDB Size Card -->
            <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                <div style="width:40px;height:40px;background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;">üíæ</div>
                <div>
                  <h4 style="margin:0;font-size:0.9rem;color:var(--accent);">DynamoDB Storage</h4>
                  <div style="font-size:0.7rem;color:var(--gray);margin-top:2px;">Total table sizes</div>
                </div>
              </div>
              <div id="dynamoTotalSize" style="font-size:1.8rem;font-weight:700;color:#3b82f6;margin-bottom:4px;">‚Äî</div>
              <div id="dynamoTableCount" style="font-size:0.8rem;color:var(--gray);">across ‚Äî tables</div>
            </div>

            <!-- Lambda Errors Card -->
            <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                <div style="width:40px;height:40px;background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;">‚ö°</div>
                <div>
                  <h4 style="margin:0;font-size:0.9rem;color:var(--accent);">Lambda Errors</h4>
                  <div style="font-size:0.7rem;color:var(--gray);margin-top:2px;">Last 24 hours</div>
                </div>
              </div>
              <div id="lambdaErrorCount" style="font-size:1.8rem;font-weight:700;color:#f59e0b;margin-bottom:4px;">‚Äî</div>
              <div id="lambdaErrorRate" style="font-size:0.8rem;color:var(--gray);">‚Äî error rate</div>
            </div>

            <!-- System Uptime Card -->
            <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                <div style="width:40px;height:40px;background:linear-gradient(135deg,#8b5cf6 0%,#6d28d9 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;">‚è±Ô∏è</div>
                <div>
                  <h4 style="margin:0;font-size:0.9rem;color:var(--accent);">API Health</h4>
                  <div style="font-size:0.7rem;color:var(--gray);margin-top:2px;">Response status</div>
                </div>
              </div>
              <div id="apiHealthStatus" style="font-size:1.4rem;font-weight:700;color:#10b981;margin-bottom:4px;">Operational</div>
              <div id="apiResponseTime" style="font-size:0.8rem;color:var(--gray);">Avg: ‚Äîms</div>
            </div>

            <!-- NATS Cluster Health Card -->
            <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
                <div style="width:40px;height:40px;background:linear-gradient(135deg,#06b6d4 0%,#0891b2 100%);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1.2rem;">üîó</div>
                <div>
                  <h4 style="margin:0;font-size:0.9rem;color:var(--accent);">NATS Cluster</h4>
                  <div style="font-size:0.7rem;color:var(--gray);margin-top:2px;">Real-time messaging</div>
                </div>
              </div>
              <div id="natsClusterStatus" style="font-size:1.4rem;font-weight:700;color:#10b981;margin-bottom:4px;">‚Äî</div>
              <div id="natsNodeCount" style="font-size:0.8rem;color:var(--gray);">‚Äî of ‚Äî nodes healthy</div>
            </div>
          </div>

          <!-- Recent Logs Viewer -->
          <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
              <h4 style="margin:0;color:var(--accent);">Recent System Logs</h4>
              <div style="display:flex;gap:8px;">
                <select id="logSourceFilter" style="padding:6px 12px;background:var(--bg-card);color:var(--text);border:1px solid var(--border);border-radius:4px;font-size:0.85rem;">
                  <option value="all">All Sources</option>
                  <option value="lambda">Lambda Functions</option>
                  <option value="api">API Gateway</option>
                  <option value="errors">Errors Only</option>
                </select>
                <button id="refreshLogs" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:6px 16px;font-size:0.85rem;">Refresh Logs</button>
              </div>
            </div>
            <div id="systemLogsContainer" style="max-height:400px;overflow-y:auto;background:var(--bg-logs);border-radius:4px;padding:12px;font-family:monospace;font-size:0.75rem;line-height:1.6;">
              <div style="color:var(--gray);">Loading logs...</div>
            </div>
          </div>
        </div>

        <!-- Event Handlers Sub-Tab -->
        <div id="event-handlers" class="sub-tab-content">
          <h3 style="margin-top:0;">Event Handlers</h3>
          <p class="muted">Manage vault event handlers (WASM services) that users can install and execute in their vaults.</p>

          <!-- Action Buttons -->
          <div style="display:flex;gap:12px;margin:16px 0;flex-wrap:wrap;">
            <button id="uploadHandlerBtn" class="btn" style="background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%);">Upload Handler</button>
            <button id="refreshHandlersBtn" class="btn">Refresh</button>
          </div>

          <!-- Status Filter Badges -->
          <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
            <button class="btn handler-filter active" data-filter="all" style="background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);padding:10px 20px;font-weight:600;">
              All <span id="allHandlersCount" style="background:var(--bg-button-secondary);color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button class="btn handler-filter" data-filter="active" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
              Active <span id="activeHandlersCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button class="btn handler-filter" data-filter="pending" style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);padding:10px 20px;font-weight:600;">
              Pending <span id="pendingHandlersCount" style="background:#92400e;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button class="btn handler-filter" data-filter="revoked" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);padding:10px 20px;font-weight:600;">
              Revoked <span id="revokedHandlersCount" style="background:#991b1b;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
          </div>

          <!-- Category Filter -->
          <div style="display:flex;gap:12px;margin-bottom:20px;align-items:center;flex-wrap:wrap;">
            <label style="font-size:0.9rem;color:var(--gray);">Category:</label>
            <select id="handlerCategoryFilter" style="padding:8px 12px;min-width:150px;">
              <option value="">All Categories</option>
              <option value="messaging">Messaging</option>
              <option value="connections">Connections</option>
              <option value="profile">Profile</option>
              <option value="social">Social</option>
              <option value="productivity">Productivity</option>
              <option value="utilities">Utilities</option>
              <option value="finance">Finance</option>
              <option value="health">Health</option>
              <option value="other">Other</option>
            </select>
            <input id="handlerSearchInput" type="text" placeholder="Search handlers..." style="padding:8px 12px;min-width:200px;" />
          </div>

          <!-- Handlers Table -->
          <div style="overflow-x:auto;overflow-y:visible;">
            <table id="handlersTable" style="overflow:visible;">
              <thead>
                <tr>
                  <th>Handler</th>
                  <th>Category</th>
                  <th>Version</th>
                  <th>Publisher</th>
                  <th>Status</th>
                  <th>Installs</th>
                  <th>Published</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="8" style="text-align:center;color:var(--gray);padding:40px;">Loading handlers...</td></tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Supported Services Sub-Tab -->
        <div id="supported-services" class="sub-tab-content">
          <h3 style="margin-top:0;">Supported Services</h3>
          <p class="muted">Manage third-party services and integrations that work with VettID vaults.</p>

          <!-- Action Buttons -->
          <div style="display:flex;gap:12px;margin:16px 0;flex-wrap:wrap;">
            <button id="addServiceBtn" class="btn" style="background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%);">Add Service</button>
            <button id="refreshServicesBtn" class="btn">Refresh</button>
          </div>

          <!-- Status Filter Badges -->
          <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
            <button class="btn service-filter active" data-filter="all" style="background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);padding:10px 20px;font-weight:600;">
              All <span id="allServicesCount" style="background:var(--bg-button-secondary);color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button class="btn service-filter" data-filter="active" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
              Active <span id="activeServicesCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button class="btn service-filter" data-filter="coming-soon" style="background:linear-gradient(135deg,#8b5cf6 0%,#7c3aed 100%);padding:10px 20px;font-weight:600;">
              Coming Soon <span id="comingSoonServicesCount" style="background:#5b21b6;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button class="btn service-filter" data-filter="deprecated" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);padding:10px 20px;font-weight:600;">
              Deprecated <span id="deprecatedServicesCount" style="background:#991b1b;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
          </div>

          <!-- Service Type Filter -->
          <div style="display:flex;gap:12px;margin-bottom:20px;align-items:center;flex-wrap:wrap;">
            <label style="font-size:0.9rem;color:var(--gray);">Service Type:</label>
            <select id="serviceTypeFilter" style="padding:8px 12px;min-width:150px;">
              <option value="">All Types</option>
              <option value="banking">Banking</option>
              <option value="messaging">Messaging</option>
              <option value="crypto">Crypto</option>
              <option value="authentication">Authentication</option>
              <option value="payments">Payments</option>
              <option value="storage">Storage</option>
              <option value="analytics">Analytics</option>
              <option value="identity">Identity</option>
              <option value="social">Social</option>
              <option value="productivity">Productivity</option>
              <option value="other">Other</option>
            </select>
            <input id="serviceSearchInput" type="text" placeholder="Search services..." style="padding:8px 12px;min-width:200px;" />
          </div>

          <!-- Services Table -->
          <div style="overflow-x:auto;overflow-y:visible;">
            <table id="servicesTable" style="overflow:visible;">
              <thead>
                <tr>
                  <th>Service</th>
                  <th>Type</th>
                  <th>Status</th>
                  <th>Connections</th>
                  <th>Featured</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="servicesTableBody">
              </tbody>
            </table>
          </div>
        </div>

        <!-- Subscription Types Sub-Tab -->
        <div id="subscription-types" class="sub-tab-content">
          <h3 style="margin-top:0;">Subscription Types</h3>
          <p class="muted">Create and manage subscription types that are displayed to users on the account page.</p>

          <button id="toggleSubscriptionTypeForm" class="btn" style="margin-top:16px;margin-bottom:16px;background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%);">Create New Subscription Type</button>

          <div id="subscriptionTypesListSection" style="padding:16px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);">
            <h4 style="margin-top:0;">Existing Subscription Types</h4>

            <!-- Filter Buttons -->
            <div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;">
              <button id="filterEnabledTypes" class="btn subscription-type-filter active" data-filter="enabled" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
                Enabled <span id="enabledTypesCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
              </button>
              <button id="filterAllTypes" class="btn subscription-type-filter" data-filter="all" style="background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);padding:10px 20px;font-weight:600;">
                All <span id="allTypesCount" style="background:var(--bg-button-secondary);color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
              </button>
            </div>

            <button id="refreshSubscriptionTypes" class="btn" style="margin-bottom:12px;">Refresh</button>
            <div id="subscriptionTypesList" class="tile-grid">
              <!-- Loading skeletons will be shown via JavaScript -->
            </div>
          </div>
        </div>

        <!-- Membership Terms Sub-Tab -->
        <div id="membership-terms" class="sub-tab-content">
          <h3 style="margin-top:0;">Membership Terms</h3>
          <p class="muted">Create and manage membership terms of service. The current version is displayed to members and saved as a PDF with the VettID logo.</p>

          <button id="toggleTermsForm" class="btn" style="margin-top:16px;margin-bottom:16px;background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%);">Create New Terms</button>

          <div id="currentTermsSection" style="padding:16px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);">
            <h4 style="margin-top:0;">Current Version</h4>
            <div id="currentTermsDisplay" class="tile-grid">
              <!-- Loading skeletons will be shown via JavaScript -->
            </div>
          </div>

          <!-- Previous Versions Section -->
          <div id="previousTermsSection" style="padding:16px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);margin-top:16px;">
            <h4 style="margin-top:0;">Previous Versions</h4>
            <div id="previousTermsDisplay" style="display:flex;flex-direction:column;gap:12px;">
              <!-- Loading skeletons will be shown via JavaScript -->
            </div>
          </div>
        </div>

        <!-- Email Sub-Tab -->
        <div id="email" class="sub-tab-content">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px;margin-bottom:16px;">
            <div>
              <h3 style="margin:0;">Email Management</h3>
              <p class="muted" style="margin:4px 0 0 0;">Send bulk emails to waitlist users, registered users, members, or subscribers.</p>
            </div>
            <button id="openComposeEmailBtn" class="btn" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;margin-right:6px;">
                <line x1="22" y1="2" x2="11" y2="13"></line>
                <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
              </svg>
              Compose Email
            </button>
          </div>

          <!-- Sent Emails History -->
          <div style="padding:20px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
              <h4 style="margin:0;">Sent Emails</h4>
              <button id="refreshSentEmails" class="btn" style="padding:8px 16px;font-size:0.85rem;">Refresh</button>
            </div>
            <p class="muted" style="margin-bottom:16px;">History of bulk emails sent to users (newest first)</p>

            <div id="sentEmailsList" style="display:flex;flex-direction:column;gap:12px;">
              <!-- Sent emails will be displayed here -->
            </div>
          </div>
        </div>
      </div>

      <div id="vote-management" class="tab-content card">
        <!-- In-Progress Sub-Tab -->
        <div id="in-progress" class="sub-tab-content active">
          <h3 style="margin-top:0;">In-Progress Proposals</h3>
          <p class="muted">Active and scheduled voting proposals.</p>

          <!-- Create New Proposal Button -->
          <button id="toggleProposalForm" class="btn" style="margin-top:16px;background:linear-gradient(135deg,#4caf50 0%,#2e7d32 100%);">Create New Proposal</button>

          <!-- Quick Filter Badges for In-Progress -->
          <div style="display:flex;gap:12px;margin-top:24px;margin-bottom:20px;flex-wrap:wrap;">
            <button id="filterActiveVotes" class="btn proposal-filter active" data-filter="active" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
              Active <span id="activeVotesCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button id="filterPendingVotes" class="btn proposal-filter" data-filter="upcoming" style="background:linear-gradient(135deg,#f59e0b 0%,#d97706 100%);padding:10px 20px;font-weight:600;">
              Scheduled <span id="pendingVotesCount" style="background:#92400e;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
          </div>

          <!-- In-Progress Proposals Container -->
          <div id="inProgressProposalsContainer" class="tile-grid" style="margin-top:16px;">
            <!-- Loading skeletons will be shown via JavaScript -->
          </div>
        </div>

        <!-- Completed Sub-Tab -->
        <div id="completed" class="sub-tab-content">
          <h3 style="margin-top:0;">Completed Proposals</h3>
          <p class="muted">Closed voting proposals with final results.</p>

          <!-- Completed Proposals Container -->
          <div id="completedProposalsContainer" class="tile-grid" style="margin-top:24px;">
            <!-- Loading skeletons will be shown via JavaScript -->
          </div>
        </div>
      </div>

      <div id="subscriptions" class="tab-content card">
        <!-- Subscriber Management Sub-Tab -->
        <div id="subscriber-management" class="sub-tab-content active">
          <h3 style="margin-top:0;">Subscriber Management</h3>

          <!-- Quick Filter Badges -->
          <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:20px;">
            <button id="quickFilterAllSubs" class="btn filter-active" style="background:linear-gradient(135deg,#a855f7 0%,#7c3aed 100%);padding:10px 20px;font-weight:600;">
              All <span id="allSubsCount" style="background:#5b21b6;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button id="quickFilterPaidSubs" class="btn" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:10px 20px;font-weight:600;">
              Paid <span id="paidSubsCount" style="background:#065f46;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
            <button id="quickFilterFreeSubs" class="btn" style="background:linear-gradient(135deg,#8b5cf6 0%,#6d28d9 100%);padding:10px 20px;font-weight:600;">
              Free <span id="freeSubsCount" style="background:#4c1d95;color:#fff;border-radius:12px;padding:2px 8px;margin-left:8px;font-size:0.75rem;">0</span>
            </button>
          </div>

          <!-- Filters and Search -->
          <div style="padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
            <h4 style="margin:0 0 12px 0;color:var(--accent);">Filters</h4>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:12px;">
              <div>
                <label for="subscriptionsSearch" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Search</label>
                <input id="subscriptionsSearch" type="text" placeholder="Name, email, plan, GUID..." style="width:100%;" />
              </div>
              <div>
                <label for="filterSubStatus" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Status</label>
                <select id="filterSubStatus" style="width:100%;">
                  <option value="">All</option>
                  <option value="active">Active</option>
                  <option value="expiring">Expiring Soon (&lt; 7 days)</option>
                  <option value="cancelled">Cancelled</option>
                  <option value="expired">Expired</option>
                </select>
              </div>
              <div>
                <label for="filterSubPlan" style="display:block;margin-bottom:4px;font-size:0.85rem;color:var(--gray);">Plan Type</label>
                <select id="filterSubPlan" style="width:100%;">
                  <option value="">All Plans</option>
                </select>
              </div>
              <button id="resetSubFilters" class="btn" style="margin-top:20px;background:var(--bg-button-secondary);">Reset Filters</button>
            </div>
          </div>

          <!-- Action Buttons -->
          <div style="margin-bottom:16px;">
            <button id="refreshSubscriptions" class="btn">Refresh</button>
            <button id="bulkExtendSubscriptions" class="btn" style="background:linear-gradient(135deg,#0e9e4d 0%,#0a7a3a 100%);margin-left:8px;">7 Day Extension</button>
            <span id="selectedSubscriptionsCount" style="margin-left:16px;color:var(--gray);"></span>
          </div>

          <!-- Subscriptions Table -->
          <div id="subscriptionsTableContainer" class="list-view">
            <table id="subscriptionsTable">
              <thead>
                <tr>
                  <th><input type="checkbox" id="selectAllSubscriptions" /></th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Plan</th>
                  <th>Status</th>
                  <th>PIN</th>
                  <th>Emails</th>
                  <th>Expires</th>
                  <th>Days Left</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div id="subscriptionsCardContainer" class="card-grid"></div>

          <!-- Pagination -->
          <div class="pagination">
            <label>Show: <select id="subscriptionsPerPage"><option value="10" selected>10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option></select></label>
            <button id="subscriptionsPrev" class="btn">Previous</button>
            <span class="info" id="subscriptionsInfo"></span>
            <button id="subscriptionsNext" class="btn">Next</button>
          </div>
        </div>

        <!-- Subscription Analytics Sub-Tab -->
        <div id="subscription-analytics" class="sub-tab-content">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
            <h3 style="margin:0;">Subscription Analytics</h3>
            <button id="refreshAnalyticsBtn" class="btn" style="padding:8px 16px;font-size:0.9rem;">Refresh</button>
          </div>

          <!-- Estimated Monthly Revenue - Now at top of analytics -->
          <div style="display:flex;align-items:center;gap:8px;padding:20px;background:var(--bg-table-header);border-radius:8px;border:1px solid var(--accent);margin-bottom:20px;box-shadow:0 4px 12px rgba(255,193,37,0.1);">
            <span style="font-size:1rem;color:var(--gray);">Estimated Monthly Revenue:</span>
            <span id="estimatedMonthlyRevenue" style="font-size:1.5rem;font-weight:700;color:var(--accent);">$0.00</span>
          </div>

          <!-- Revenue Insights -->
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px;">
            <!-- Revenue by Plan Type Card -->
            <div style="padding:20px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);">
              <h4 style="margin:0 0 16px 0;color:var(--accent);font-size:0.95rem;">Revenue by Plan Type</h4>
              <div id="revenueByPlan" style="display:flex;flex-direction:column;gap:12px;">
                <div style="color:var(--gray);font-size:0.85rem;">Loading...</div>
              </div>
            </div>

            <!-- Subscription Growth Card -->
            <div style="padding:20px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);">
              <h4 style="margin:0 0 16px 0;color:var(--accent);font-size:0.95rem;">Subscription Growth</h4>
              <div style="display:flex;flex-direction:column;gap:12px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="color:var(--gray);font-size:0.85rem;">This Month:</span>
                  <span id="growthThisMonth" style="font-weight:600;color:#10b981;">+0</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="color:var(--gray);font-size:0.85rem;">Last 30 Days:</span>
                  <span id="growthLast30Days" style="font-weight:600;color:#10b981;">+0</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="color:var(--gray);font-size:0.85rem;">Growth Rate:</span>
                  <span id="growthRate" style="font-weight:600;color:#10b981;">0%</span>
                </div>
              </div>
            </div>

            <!-- Churn Metrics Card -->
            <div style="padding:20px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);">
              <h4 style="margin:0 0 16px 0;color:var(--accent);font-size:0.95rem;">Churn Metrics</h4>
              <div style="display:flex;flex-direction:column;gap:12px;">
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="color:var(--gray);font-size:0.85rem;">Cancelled (30d):</span>
                  <span id="churnCancelled" style="font-weight:600;color:#f59e0b;">0</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="color:var(--gray);font-size:0.85rem;">Expired (30d):</span>
                  <span id="churnExpired" style="font-weight:600;color:#ef4444;">0</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;">
                  <span style="color:var(--gray);font-size:0.85rem;">Churn Rate:</span>
                  <span id="churnRate" style="font-weight:600;color:#ef4444;">0%</span>
                </div>
                <div style="display:flex;justify-content:space-between;align-items:center;padding-top:8px;border-top:1px solid var(--border);">
                  <span style="color:var(--gray);font-size:0.85rem;">Retention Rate:</span>
                  <span id="retentionRate" style="font-weight:600;color:#10b981;">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script src="/shared/config.js"></script>
<script src="/vendor/flatpickr/flatpickr.min.js"></script>
<script src="/js/admin.js"></script>

<!-- Select Notification Admin Modal -->
<div id="selectNotificationAdminModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 id="selectNotificationAdminTitle" class="modal-title">Select Admin</h3>
      <button class="modal-close" data-action="closeSelectNotificationAdminModal">&times;</button>
    </div>
    <div class="modal-body" id="notificationAdminList">
      <!-- Admin options will be populated dynamically -->
    </div>
  </div>
</div>

<!-- Manage Access Modal -->
<div id="manageAccessModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 id="manageAccessTitle" class="modal-title">Manage Access</h3>
      <button class="modal-close" data-action="closeManageAccessModal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="modal-option" data-action="handleToggleAdminStatus">
        <div id="statusActionTitle" class="modal-option-title">Disable Admin</div>
        <div id="statusActionDesc" class="modal-option-desc">Prevent this admin from logging in</div>
      </div>
      <div class="modal-option" data-action="openChangeAdminTypeModal">
        <div class="modal-option-title">Change Admin Type</div>
        <div class="modal-option-desc">Modify access level and permissions</div>
      </div>
      <div class="modal-option" data-action="handleResetAdminPassword">
        <div class="modal-option-title">Reset Password</div>
        <div class="modal-option-desc">Generate temporary password and email to admin</div>
      </div>
      <div class="modal-option" data-action="handleDeleteAdmin">
        <div class="modal-option-title" style="color:#ef4444;">Delete Admin</div>
        <div class="modal-option-desc">Permanently remove this admin account</div>
      </div>
    </div>
  </div>
</div>

<!-- Change Admin Type Modal -->
<div id="changeAdminTypeModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Change Admin Type</h3>
      <button class="modal-close" data-action="closeChangeAdminTypeModal">&times;</button>
    </div>
    <div class="modal-body">
      <p id="currentAdminType" style="margin-bottom:16px;color:var(--gray);font-size:0.9rem;">Current: Admin</p>
      <label for="newAdminType" style="display:block;margin-bottom:8px;font-weight:600;">Select New Admin Type:</label>
      <select id="newAdminType" style="width:100%;padding:10px;margin-bottom:16px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);">
        <option value="admin">Admin - Full Access</option>
        <option value="user_admin">User Admin - Waitlist and Users</option>
        <option value="subscriber_admin">Subscriber Admin - Waitlist, Users, Subscribers and Invites</option>
        <option value="vote_admin">Vote Admin - Vote Management</option>
      </select>
      <div style="display:flex;gap:12px;">
        <button data-action="handleChangeAdminType" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Update Type</button>
        <button data-action="closeChangeAdminTypeModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Activity Log Modal -->
<div id="activityLogModal" class="modal-overlay">
  <div class="modal" style="max-width:900px;">
    <div class="modal-header">
      <h3 id="activityLogTitle" class="modal-title">Activity Log</h3>
      <button class="modal-close" data-action="closeActivityLogModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:20px;">
        <div style="padding:12px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Total Actions</div>
          <div id="activityTotalCount" style="font-size:1.5rem;font-weight:600;color:#10b981;">0</div>
        </div>
        <div style="padding:12px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Last 7 Days</div>
          <div id="activityLast7Days" style="font-size:1.5rem;font-weight:600;color:#3b82f6;">0</div>
        </div>
        <div style="padding:12px;background:var(--bg-card);border-radius:4px;border:1px solid var(--border);">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Last 30 Days</div>
          <div id="activityLast30Days" style="font-size:1.5rem;font-weight:600;color:#f59e0b;">0</div>
        </div>
      </div>

      <div style="margin-bottom:12px;display:flex;gap:12px;flex-wrap:wrap;">
        <button id="filterAllActivity" class="btn activity-filter active" data-filter="all" style="background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);padding:8px 16px;">All</button>
        <button id="filterLoginActivity" class="btn activity-filter" data-filter="login" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);padding:8px 16px;">Logins</button>
        <button id="filterActionActivity" class="btn activity-filter" data-filter="action" style="background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);padding:8px 16px;">Actions</button>
        <button id="filterErrorActivity" class="btn activity-filter" data-filter="error" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);padding:8px 16px;">Errors</button>
      </div>

      <div id="activityLogContent" style="max-height:400px;overflow-y:auto;background:var(--bg-input);border-radius:4px;padding:16px;">
        <div style="padding:12px 0;">
          <div class="skeleton" style="height:60px;margin-bottom:12px;border-radius:6px;"></div>
          <div class="skeleton" style="height:60px;margin-bottom:12px;border-radius:6px;"></div>
          <div class="skeleton" style="height:60px;margin-bottom:12px;border-radius:6px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create Invite Modal -->
<div id="createInviteModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Create Invite</h3>
      <button class="modal-close" data-action="closeCreateInviteModal">&times;</button>
    </div>
    <div class="modal-body">
      <label for="customCode" style="display:block;margin-bottom:8px;font-weight:600;">Custom code (optional)</label>
      <input id="customCode" type="text" placeholder="Leave blank to auto-generate" style="width:100%;margin-bottom:12px;" />
      <label for="maxUses" style="display:block;margin-bottom:8px;font-weight:600;">Max uses</label>
      <input id="maxUses" type="number" min="1" value="1" style="width:100%;margin-bottom:12px;" />
      <label for="expiresAt" style="display:block;margin-bottom:8px;font-weight:600;">Expiration date & time (optional)</label>
      <input id="expiresAt" type="text" placeholder="Select date & time" style="max-width:280px;margin-bottom:12px;" />
      <label style="display:flex;align-items:center;gap:8px;margin-bottom:16px;cursor:pointer;">
        <input id="autoApprove" type="checkbox" />
        <span>Auto-approve registrations</span>
      </label>
      <div style="display:flex;gap:12px;">
        <button id="createInviteBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Create</button>
        <button data-action="closeCreateInviteModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
      <div id="inviteMsg" style="margin-top:12px;"></div>
    </div>
  </div>
</div>

<!-- Invite Admin User Modal -->
<div id="addAdminModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Invite Admin User</h3>
      <button class="modal-close" data-action="closeAddAdminModal">&times;</button>
    </div>
    <div class="modal-body">
      <p style="color:var(--gray);font-size:0.85rem;margin-bottom:16px;">The invited admin will receive a verification email from AWS. Once they click the verification link, you can activate their account and they'll receive their login credentials.</p>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
        <div>
          <label for="adminFirstName" style="display:block;margin-bottom:8px;font-weight:600;">First Name</label>
          <input id="adminFirstName" type="text" placeholder="John" style="width:100%" />
        </div>
        <div>
          <label for="adminLastName" style="display:block;margin-bottom:8px;font-weight:600;">Last Name</label>
          <input id="adminLastName" type="text" placeholder="Doe" style="width:100%" />
        </div>
      </div>
      <div style="margin-bottom:12px;">
        <label for="adminEmail" style="display:block;margin-bottom:8px;font-weight:600;">Email</label>
        <input id="adminEmail" type="email" placeholder="admin@example.com" style="width:100%;" />
      </div>
      <div style="margin-bottom:16px;">
        <label for="adminType" style="display:block;margin-bottom:8px;font-weight:600;">Admin Type</label>
        <select id="adminType" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);">
          <option value="admin">Admin - Full Access</option>
          <option value="user_admin">User Admin - Waitlist and Users</option>
          <option value="subscriber_admin">Subscriber Admin - Waitlist, Users, Subscribers and Invites</option>
          <option value="vote_admin">Vote Admin - Vote Management</option>
        </select>
      </div>
      <div style="display:flex;gap:12px;">
        <button id="addAdminBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Send Invitation</button>
        <button data-action="closeAddAdminModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
      <div id="adminMsg" style="margin-top:12px;"></div>
    </div>
  </div>
</div>

<!-- Create Subscription Type Modal -->
<div id="createSubscriptionTypeModal" class="modal-overlay">
  <div class="modal" style="max-width:600px;">
    <div class="modal-header">
      <h3 class="modal-title">Create Subscription Type</h3>
      <button class="modal-close" data-action="closeCreateSubscriptionTypeModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:12px;">
        <label for="subTypeName" style="display:block;margin-bottom:6px;font-weight:600;font-size:0.9rem;">Name</label>
        <input type="text" id="subTypeName" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" placeholder="e.g., Monthly, Annual, Lifetime" />
      </div>
      <div style="margin-bottom:12px;">
        <label for="subTypeDescription" style="display:block;margin-bottom:6px;font-weight:600;font-size:0.9rem;">Description</label>
        <textarea id="subTypeDescription" rows="2" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);resize:vertical;" placeholder="Brief description"></textarea>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
        <div>
          <label for="subTermValue" style="display:block;margin-bottom:6px;font-weight:600;font-size:0.9rem;">Duration</label>
          <input type="number" id="subTermValue" min="1" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" placeholder="1" />
        </div>
        <div>
          <label for="subTermUnit" style="display:block;margin-bottom:6px;font-weight:600;font-size:0.9rem;">Unit</label>
          <select id="subTermUnit" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);">
            <option value="days">Days</option>
            <option value="months" selected>Months</option>
            <option value="years">Years</option>
          </select>
        </div>
      </div>
      <div style="margin-bottom:12px;">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="checkbox" id="subTypeFree" style="width:16px;height:16px;" />
          <span style="font-weight:600;font-size:0.9rem;">Free (no payment required)</span>
        </label>
      </div>
      <div id="pricingFields" style="display:grid;grid-template-columns:100px 1fr;gap:12px;margin-bottom:12px;">
        <div>
          <label for="subTypeCurrency" style="display:block;margin-bottom:6px;font-weight:600;font-size:0.9rem;">Currency</label>
          <select id="subTypeCurrency" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);">
            <option value="USD" selected>USD ($)</option>
            <option value="EUR">EUR (‚Ç¨)</option>
            <option value="GBP">GBP (¬£)</option>
          </select>
        </div>
        <div>
          <label for="subTypePrice" style="display:block;margin-bottom:6px;font-weight:600;font-size:0.9rem;">Price</label>
          <input type="number" id="subTypePrice" min="0" step="0.01" style="width:100%;padding:8px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" placeholder="10.00" />
        </div>
      </div>
      <div style="margin-bottom:12px;">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="checkbox" id="subTypeOneTime" style="width:16px;height:16px;" />
          <span style="font-weight:600;font-size:0.9rem;">One-Time Offer</span>
        </label>
      </div>
      <div style="margin-bottom:12px;">
        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
          <input type="checkbox" id="subTypeEnabled" checked style="width:16px;height:16px;" />
          <span style="font-weight:600;font-size:0.9rem;">Enable Immediately</span>
        </label>
      </div>
      <div style="display:flex;gap:12px;">
        <button id="createSubscriptionTypeBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Create</button>
        <button data-action="closeCreateSubscriptionTypeModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
      <div id="subscriptionTypeMsg" style="margin-top:12px;"></div>
    </div>
  </div>
</div>

<!-- Create Terms Modal -->
<div id="createTermsModal" class="modal-overlay">
  <div class="modal" style="max-width:700px;">
    <div class="modal-header">
      <h3 class="modal-title">Create New Terms</h3>
      <button class="modal-close" data-action="closeCreateTermsModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:16px;">
        <label for="newTermsText" style="display:block;margin-bottom:8px;font-weight:600;">New Terms Text</label>
        <textarea id="newTermsText" rows="12" style="width:100%;padding:12px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);font-family:monospace;font-size:0.9rem;resize:vertical;" placeholder="Paste your membership terms of service here..."></textarea>
      </div>
      <div style="display:flex;gap:12px;">
        <button id="createTermsBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Create New Version</button>
        <button data-action="closeCreateTermsModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
      <div id="termsMsg" style="margin-top:12px;"></div>
    </div>
  </div>
</div>

<!-- Confirm Terms Creation Modal -->
<div id="confirmTermsModal" class="modal-overlay">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <h3 class="modal-title">Confirm New Terms</h3>
      <button class="modal-close" data-action="closeConfirmTermsModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:24px;">
        <p style="font-size:1rem;line-height:1.6;color:var(--text);margin-bottom:12px;">
          Are you sure you want to create a new version of membership terms?
        </p>
        <p style="font-size:0.9rem;line-height:1.6;color:var(--gray);">
          This will replace the current version and generate a new PDF with the VettID logo. The previous version will be archived and remain accessible.
        </p>
      </div>
      <div style="display:flex;gap:12px;">
        <button id="confirmCreateTermsBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);font-weight:600;">
          Confirm
        </button>
        <button data-action="closeConfirmTermsModal" class="btn" style="flex:1;background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Generic Confirmation Modal -->
<div id="genericConfirmModal" class="modal-overlay">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <h3 id="genericConfirmTitle" class="modal-title">Confirm Action</h3>
      <button class="modal-close" data-action="closeGenericConfirmModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:24px;">
        <p id="genericConfirmMessage" style="font-size:1rem;line-height:1.6;color:var(--text);white-space:pre-wrap;"></p>
      </div>
      <div style="display:flex;gap:12px;">
        <button id="genericConfirmBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);font-weight:600;">
          Confirm
        </button>
        <button data-action="closeGenericConfirmModal" class="btn" style="flex:1;background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);">
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Create Proposal Modal -->
<div id="createProposalModal" class="modal-overlay">
  <div class="modal" style="max-width:600px;max-height:90vh;overflow-y:auto;">
    <div class="modal-header">
      <h3 class="modal-title">Create New Proposal</h3>
      <button class="modal-close" data-action="closeCreateProposalModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:16px;">
        <label for="proposalTitle" style="display:block;margin-bottom:8px;font-weight:600;">Proposal Title</label>
        <input type="text" id="proposalTitle" style="width:100%;padding:10px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" placeholder="Enter a short title for this proposal" />
      </div>
      <div style="margin-bottom:16px;">
        <label for="proposalText" style="display:block;margin-bottom:8px;font-weight:600;">Proposal Text</label>
        <textarea id="proposalText" rows="6" style="width:100%;padding:12px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);resize:vertical;" placeholder="Enter the proposal text here..."></textarea>
      </div>
      <div style="margin-bottom:16px;">
        <label for="proposalCategory" style="display:block;margin-bottom:8px;font-weight:600;">Category</label>
        <select id="proposalCategory" style="width:100%;max-width:280px;padding:10px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);">
          <option value="governance">Governance</option>
          <option value="policy">Policy</option>
          <option value="budget">Budget</option>
          <option value="funding">Funding</option>
          <option value="operational">Operational</option>
          <option value="other" selected>Other</option>
        </select>
      </div>
      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:8px;font-weight:600;">Quorum Requirement</label>
        <div style="display:flex;gap:12px;flex-wrap:wrap;">
          <select id="proposalQuorumType" style="padding:10px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);">
            <option value="none" selected>No quorum required</option>
            <option value="percentage">Percentage of members</option>
            <option value="count">Minimum vote count</option>
          </select>
          <input type="number" id="proposalQuorumValue" placeholder="Value" min="1" style="display:none;width:100px;padding:10px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" />
          <span id="quorumValueLabel" style="display:none;align-self:center;color:var(--gray);font-size:0.85rem;"></span>
        </div>
      </div>
      <div style="margin-bottom:16px;">
        <div style="margin-bottom:16px;">
          <label for="proposalOpenDate" style="display:block;margin-bottom:8px;font-weight:600;">Opening Date & Time</label>
          <input type="text" id="proposalOpenDate" placeholder="Select opening date & time" style="max-width:280px;padding:10px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" />
        </div>
        <div>
          <label for="proposalCloseDate" style="display:block;margin-bottom:8px;font-weight:600;">Closing Date & Time</label>
          <input type="text" id="proposalCloseDate" placeholder="Select closing date & time" style="max-width:280px;padding:10px;border-radius:4px;border:1px solid var(--border);background:var(--bg-input);color:var(--text);" />
        </div>
      </div>
      <div style="display:flex;gap:12px;">
        <button id="createProposalBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Create Proposal</button>
        <button data-action="closeCreateProposalModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
      <div id="proposalMsg" style="margin-top:12px;"></div>
    </div>
  </div>
</div>

<!-- Proposal Analytics Modal -->
<div id="proposalAnalyticsModal" class="modal-overlay">
  <div class="modal" style="max-width:700px;">
    <div class="modal-header">
      <h3 class="modal-title">Proposal Analytics</h3>
      <button class="modal-close" data-action="closeProposalAnalyticsModal">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Proposal Title -->
      <div style="margin-bottom:20px;padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);">
        <h4 id="analyticsProposalTitle" style="margin:0;font-size:1.1rem;color:var(--accent);"></h4>
        <div id="analyticsProposalStatus" style="margin-top:8px;"></div>
      </div>

      <!-- Vote Statistics Cards -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px;">
        <!-- Total Votes -->
        <div style="padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);text-align:center;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:6px;font-weight:600;">Total Votes</div>
          <div id="analyticsTotalVotes" style="font-size:1.8rem;font-weight:700;color:var(--accent);">‚Äî</div>
        </div>

        <!-- Turnout -->
        <div style="padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);text-align:center;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:6px;font-weight:600;">Voter Turnout</div>
          <div id="analyticsTurnout" style="font-size:1.8rem;font-weight:700;color:#10b981;">‚Äî</div>
        </div>

        <!-- Result -->
        <div id="analyticsResultCard" style="padding:16px;background:var(--bg-card);border-radius:8px;border:1px solid var(--border);text-align:center;display:none;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:6px;font-weight:600;">Result</div>
          <div id="analyticsResult" style="font-size:1.4rem;font-weight:700;">‚Äî</div>
        </div>
      </div>

      <!-- Vote Breakdown -->
      <div style="padding:20px;background:var(--bg-input);border-radius:8px;border:1px solid var(--border);margin-bottom:20px;">
        <h4 style="margin:0 0 16px 0;color:var(--accent);font-size:0.95rem;">Vote Breakdown</h4>

        <!-- Yes Votes -->
        <div style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span style="font-size:0.85rem;color:#10b981;font-weight:600;">Yes</span>
            <span id="analyticsYesCount" style="font-size:0.85rem;font-weight:600;">0 (0%)</span>
          </div>
          <div id="analyticsYesBar" style="height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden;">
            <div style="height:100%;width:0%;background:linear-gradient(90deg,#10b981,#059669);transition:width 0.3s;"></div>
          </div>
        </div>

        <!-- No Votes -->
        <div style="margin-bottom:12px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span style="font-size:0.85rem;color:#ef4444;font-weight:600;">No</span>
            <span id="analyticsNoCount" style="font-size:0.85rem;font-weight:600;">0 (0%)</span>
          </div>
          <div id="analyticsNoBar" style="height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden;">
            <div style="height:100%;width:0%;background:linear-gradient(90deg,#ef4444,#dc2626);transition:width 0.3s;"></div>
          </div>
        </div>

        <!-- Abstain Votes -->
        <div style="margin-bottom:0;">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span style="font-size:0.85rem;color:#6b7280;font-weight:600;">Abstain</span>
            <span id="analyticsAbstainCount" style="font-size:0.85rem;font-weight:600;">0 (0%)</span>
          </div>
          <div id="analyticsAbstainBar" style="height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden;">
            <div style="height:100%;width:0%;background:linear-gradient(90deg,#6b7280,#4b5563);transition:width 0.3s;"></div>
          </div>
        </div>
      </div>

      <!-- Close Button -->
      <div style="display:flex;">
        <button data-action="closeProposalAnalyticsModal" class="btn" style="width:100%;background:linear-gradient(135deg,#6b7280 0%,#4b5563 100%);">Close</button>
      </div>

      <div id="analyticsMsg" style="margin-top:12px;text-align:center;color:var(--gray);"></div>
    </div>
  </div>
</div>

<!-- Upload Handler Modal -->
<div id="uploadHandlerModal" class="modal-overlay">
  <div class="modal" style="max-width:600px;max-height:90vh;overflow-y:auto;">
    <div class="modal-header">
      <h3 class="modal-title">Upload Handler</h3>
      <button class="modal-close" data-action="closeUploadHandlerModal">&times;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom:16px;color:var(--gray);font-size:0.9rem;">
        Upload a new handler or add a new version to an existing handler.
      </p>

      <!-- Handler ID -->
      <div style="margin-bottom:16px;">
        <label for="handlerIdInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Handler ID <span style="color:#ef4444;">*</span>
        </label>
        <input type="text" id="handlerIdInput" placeholder="e.g., signal-encryption" style="width:100%;" />
        <div style="font-size:0.75rem;color:var(--gray);margin-top:4px;">Lowercase letters, numbers, and hyphens only</div>
      </div>

      <!-- Handler Name -->
      <div style="margin-bottom:16px;">
        <label for="handlerNameInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Display Name <span style="color:#ef4444;">*</span>
        </label>
        <input type="text" id="handlerNameInput" placeholder="e.g., Signal Encryption" style="width:100%;" />
      </div>

      <!-- Version -->
      <div style="margin-bottom:16px;">
        <label for="handlerVersionInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Version <span style="color:#ef4444;">*</span>
        </label>
        <input type="text" id="handlerVersionInput" placeholder="e.g., 1.0.0" style="width:100%;" />
        <div style="font-size:0.75rem;color:var(--gray);margin-top:4px;">Semantic versioning (X.Y.Z)</div>
      </div>

      <!-- Category -->
      <div style="margin-bottom:16px;">
        <label for="handlerCategoryInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Category <span style="color:#ef4444;">*</span>
        </label>
        <select id="handlerCategoryInput" style="width:100%;">
          <option value="">Select category...</option>
          <option value="messaging">Messaging</option>
          <option value="connections">Connections</option>
          <option value="profile">Profile</option>
          <option value="social">Social</option>
          <option value="productivity">Productivity</option>
          <option value="utilities">Utilities</option>
          <option value="finance">Finance</option>
          <option value="health">Health</option>
          <option value="other">Other</option>
        </select>
      </div>

      <!-- Publisher -->
      <div style="margin-bottom:16px;">
        <label for="handlerPublisherInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Publisher <span style="color:#ef4444;">*</span>
        </label>
        <input type="text" id="handlerPublisherInput" placeholder="e.g., VettID Team" style="width:100%;" />
      </div>

      <!-- Description -->
      <div style="margin-bottom:16px;">
        <label for="handlerDescriptionInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Description <span style="color:#ef4444;">*</span>
        </label>
        <textarea id="handlerDescriptionInput" placeholder="Describe what this handler does..." style="width:100%;min-height:80px;resize:vertical;"></textarea>
      </div>

      <!-- Icon Selection -->
      <div style="margin-bottom:16px;">
        <label style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Icon <span style="color:var(--gray);font-weight:400;">(optional)</span>
        </label>
        <div style="position:relative;">
          <button type="button" id="iconPickerBtn" data-action="toggleIconPicker" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;cursor:pointer;color:var(--text);text-align:left;">
            <span id="iconPickerPreview" style="font-size:1.5rem;width:32px;text-align:center;">üì¶</span>
            <span id="iconPickerText" style="flex:1;color:var(--gray);">Select an icon...</span>
            <span style="color:var(--gray);">‚ñº</span>
          </button>
          <!-- Icon Picker Dropdown -->
          <div id="iconPickerDropdown" style="display:none;position:absolute;top:100%;left:0;right:0;margin-top:4px;background:var(--bg-card);border:1px solid var(--accent);border-radius:6px;box-shadow:0 8px 24px rgba(0,0,0,0.4);z-index:100;max-height:300px;overflow-y:auto;">
            <div style="padding:12px;border-bottom:1px solid var(--border);">
              <div style="font-size:0.85rem;font-weight:600;margin-bottom:8px;color:var(--accent);">Preset Icons</div>
              <div style="display:grid;grid-template-columns:repeat(8,1fr);gap:6px;">
                <button type="button" data-action="selectPresetIcon" data-icon-id="gear" data-icon-emoji="‚öôÔ∏è" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Settings">‚öôÔ∏è</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="code" data-icon-emoji="üíª" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Code">üíª</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="lock" data-icon-emoji="üîí" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Security">üîí</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="key" data-icon-emoji="üîë" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Key">üîë</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="shield" data-icon-emoji="üõ°Ô∏è" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Shield">üõ°Ô∏è</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="bolt" data-icon-emoji="‚ö°" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Lightning">‚ö°</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="cloud" data-icon-emoji="‚òÅÔ∏è" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Cloud">‚òÅÔ∏è</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="database" data-icon-emoji="üóÑÔ∏è" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Database">üóÑÔ∏è</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="link" data-icon-emoji="üîó" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Link">üîó</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="bell" data-icon-emoji="üîî" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Notification">üîî</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="mail" data-icon-emoji="üìß" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Mail">üìß</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="chart" data-icon-emoji="üìä" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Analytics">üìä</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="folder" data-icon-emoji="üìÅ" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Folder">üìÅ</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="globe" data-icon-emoji="üåê" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Web">üåê</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="robot" data-icon-emoji="ü§ñ" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Automation">ü§ñ</button>
                <button type="button" data-action="selectPresetIcon" data-icon-id="puzzle" data-icon-emoji="üß©" style="padding:8px;border-radius:4px;border:none;background:var(--bg-input);cursor:pointer;font-size:1.2rem;" title="Plugin">üß©</button>
              </div>
            </div>
            <div style="padding:12px;">
              <div style="font-size:0.85rem;font-weight:600;margin-bottom:8px;color:var(--accent);">Custom URL</div>
              <div style="display:flex;gap:8px;">
                <input type="url" id="handlerIconInput" placeholder="https://example.com/icon.png" style="flex:1;" />
                <button type="button" data-action="applyCustomIconUrl" class="btn" style="padding:8px 16px;font-size:0.85rem;">Apply</button>
              </div>
              <p style="margin:4px 0 0;font-size:0.75rem;color:var(--gray);">Enter a direct URL to an image</p>
            </div>
            <div style="padding:8px 12px;border-top:1px solid var(--border);">
              <button type="button" data-action="clearIconSelection" style="width:100%;padding:8px;background:none;border:none;color:var(--gray);cursor:pointer;font-size:0.85rem;">Clear selection</button>
            </div>
          </div>
        </div>
        <input type="hidden" id="selectedPresetIcon" value="" />
        <input type="hidden" id="selectedIconEmoji" value="" />
      </div>

      <!-- Changelog (optional) -->
      <div style="margin-bottom:16px;">
        <label for="handlerChangelogInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Changelog <span style="color:var(--gray);font-weight:400;">(optional)</span>
        </label>
        <textarea id="handlerChangelogInput" placeholder="What's new in this version..." style="width:100%;min-height:60px;resize:vertical;"></textarea>
      </div>

      <!-- Upload Result -->
      <div id="uploadHandlerResult" style="display:none;margin-bottom:16px;padding:16px;background:var(--bg-input);border:1px solid var(--border);border-radius:6px;">
        <h4 style="margin:0 0 12px 0;color:var(--accent);font-size:0.95rem;">Handler Created - Upload WASM</h4>
        <p style="font-size:0.85rem;color:var(--gray);margin-bottom:12px;">
          Now upload your WASM file to complete the handler registration.
        </p>
        <input type="file" id="wasmFileInput" accept=".wasm" style="margin-bottom:12px;width:100%;" />
        <button id="uploadWasmBtn" class="btn" style="width:100%;background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);" disabled>Upload WASM File</button>
        <div id="wasmUploadProgress" style="display:none;margin-top:12px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:4px;">
            <span style="font-size:0.85rem;color:var(--gray);">Uploading...</span>
            <span id="wasmUploadPercent" style="font-size:0.85rem;font-weight:600;">0%</span>
          </div>
          <div style="background:var(--bg-tertiary);border-radius:4px;height:6px;overflow:hidden;">
            <div id="wasmUploadBar" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);height:100%;width:0%;transition:width 0.3s ease;"></div>
          </div>
        </div>
      </div>

      <!-- Actions -->
      <div style="display:flex;gap:12px;">
        <button id="createHandlerBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);">Create Handler</button>
        <button data-action="closeUploadHandlerModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
      </div>

      <div id="uploadHandlerMsg" style="margin-top:12px;text-align:center;"></div>
    </div>
  </div>
</div>

<!-- Handler Details Modal -->
<div id="handlerDetailsModal" class="modal-overlay">
  <div class="modal" style="max-width:700px;max-height:90vh;overflow-y:auto;">
    <div class="modal-header">
      <h3 class="modal-title">Handler Details</h3>
      <button class="modal-close" data-action="closeHandlerDetailsModal">&times;</button>
    </div>
    <div class="modal-body">
      <!-- Handler Header -->
      <div style="display:flex;gap:16px;align-items:flex-start;margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid var(--border);">
        <div id="handlerIcon" style="width:64px;height:64px;background:var(--bg-tertiary);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2rem;flex-shrink:0;">üì¶</div>
        <div style="flex:1;">
          <h2 id="handlerDetailName" style="margin:0 0 4px 0;font-size:1.4rem;"></h2>
          <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
            <span id="handlerDetailId" style="font-size:0.85rem;color:var(--gray);font-family:monospace;"></span>
            <span id="handlerDetailStatus" style="padding:4px 10px;border-radius:4px;font-size:0.75rem;font-weight:700;text-transform:uppercase;"></span>
          </div>
        </div>
      </div>

      <!-- Info Grid -->
      <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:12px;margin-bottom:20px;">
        <div style="padding:12px;background:var(--bg-input);border-radius:6px;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Version</div>
          <div id="handlerDetailVersion" style="font-weight:600;"></div>
        </div>
        <div style="padding:12px;background:var(--bg-input);border-radius:6px;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Category</div>
          <div id="handlerDetailCategory" style="font-weight:600;text-transform:capitalize;"></div>
        </div>
        <div style="padding:12px;background:var(--bg-input);border-radius:6px;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Publisher</div>
          <div id="handlerDetailPublisher" style="font-weight:600;"></div>
        </div>
        <div style="padding:12px;background:var(--bg-input);border-radius:6px;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Installs</div>
          <div id="handlerDetailInstalls" style="font-weight:600;"></div>
        </div>
        <div style="padding:12px;background:var(--bg-input);border-radius:6px;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Size</div>
          <div id="handlerDetailSize" style="font-weight:600;"></div>
        </div>
        <div style="padding:12px;background:var(--bg-input);border-radius:6px;">
          <div style="font-size:0.75rem;color:var(--gray);margin-bottom:4px;">Published</div>
          <div id="handlerDetailPublished" style="font-weight:600;"></div>
        </div>
      </div>

      <!-- Description -->
      <div style="margin-bottom:20px;">
        <h4 style="margin:0 0 8px 0;font-size:0.95rem;color:var(--accent);">Description</h4>
        <p id="handlerDetailDescription" style="margin:0;color:var(--gray);line-height:1.6;"></p>
      </div>

      <!-- Changelog -->
      <div id="handlerChangelogSection" style="margin-bottom:20px;display:none;">
        <h4 style="margin:0 0 8px 0;font-size:0.95rem;color:var(--accent);">Changelog</h4>
        <p id="handlerDetailChangelog" style="margin:0;color:var(--gray);line-height:1.6;white-space:pre-wrap;"></p>
      </div>

      <!-- Versions -->
      <div style="margin-bottom:20px;">
        <h4 style="margin:0 0 8px 0;font-size:0.95rem;color:var(--accent);">All Versions</h4>
        <div id="handlerDetailVersions" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
      </div>

      <!-- Permissions -->
      <div id="handlerPermissionsSection" style="margin-bottom:20px;display:none;">
        <h4 style="margin:0 0 8px 0;font-size:0.95rem;color:var(--accent);">Permissions</h4>
        <div id="handlerDetailPermissions" style="display:flex;flex-direction:column;gap:8px;"></div>
      </div>

      <!-- Audit Info -->
      <div style="margin-bottom:20px;padding:16px;background:var(--bg-input);border-radius:6px;">
        <h4 style="margin:0 0 12px 0;font-size:0.95rem;color:var(--accent);">Audit Trail</h4>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;font-size:0.85rem;">
          <div><span style="color:var(--gray);">Created:</span> <span id="handlerDetailCreatedAt"></span> by <span id="handlerDetailCreatedBy"></span></div>
          <div><span style="color:var(--gray);">Updated:</span> <span id="handlerDetailUpdatedAt"></span></div>
          <div id="handlerSignedInfo" style="display:none;"><span style="color:var(--gray);">Signed:</span> <span id="handlerDetailSignedAt"></span> by <span id="handlerDetailSignedBy"></span></div>
          <div id="handlerRevokedInfo" style="display:none;"><span style="color:#ef4444;">Revoked:</span> <span id="handlerDetailRevokedAt"></span> by <span id="handlerDetailRevokedBy"></span></div>
        </div>
        <div id="handlerRevocationReason" style="display:none;margin-top:12px;padding:12px;background:rgba(239,68,68,0.1);border:1px solid #ef4444;border-radius:4px;">
          <span style="color:#ef4444;font-weight:600;">Revocation Reason:</span>
          <span id="handlerDetailRevocationReason"></span>
        </div>
      </div>

      <!-- Action Buttons -->
      <div id="handlerDetailActions" style="display:flex;gap:12px;flex-wrap:wrap;">
        <button id="signHandlerBtn" class="btn" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);display:none;">Sign & Activate</button>
        <button id="revokeHandlerBtn" class="btn" style="background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);display:none;">Revoke Handler</button>
        <button data-action="closeHandlerDetailsModal" class="btn" style="background:var(--bg-button-secondary);">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Revoke Handler Modal -->
<div id="revokeHandlerModal" class="modal-overlay">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <h3 class="modal-title">Revoke Handler</h3>
      <button class="modal-close" data-action="closeRevokeHandlerModal">&times;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom:16px;color:var(--gray);">
        Are you sure you want to revoke <strong id="revokeHandlerName"></strong>? This will prevent new installations but existing installations will remain.
      </p>

      <div style="margin-bottom:16px;">
        <label for="revocationReasonInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Revocation Reason <span style="color:#ef4444;">*</span>
        </label>
        <textarea id="revocationReasonInput" placeholder="Why is this handler being revoked?" style="width:100%;min-height:80px;resize:vertical;"></textarea>
      </div>

      <div style="display:flex;gap:12px;">
        <button id="confirmRevokeBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);">Revoke Handler</button>
        <button data-action="closeRevokeHandlerModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
      </div>

      <div id="revokeHandlerMsg" style="margin-top:12px;text-align:center;"></div>
    </div>
  </div>
</div>

<!-- Delete Handler Modal -->
<div id="deleteHandlerModal" class="modal-overlay">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <h3 class="modal-title" style="color:#ef4444;">Delete Handler</h3>
      <button class="modal-close" data-action="closeDeleteHandlerModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:8px;padding:16px;margin-bottom:16px;">
        <div style="display:flex;align-items:flex-start;gap:12px;">
          <span style="font-size:1.5rem;">&#9888;</span>
          <div>
            <div style="font-weight:600;color:#ef4444;margin-bottom:4px;">Warning: This action is irreversible</div>
            <div style="font-size:0.9rem;color:var(--gray);">
              Deleting a handler will permanently remove it from the registry, including all versions and WASM packages. This cannot be undone.
            </div>
          </div>
        </div>
      </div>

      <p style="margin-bottom:16px;color:var(--text-primary);">
        Are you sure you want to permanently delete <strong id="deleteHandlerName" style="color:#ef4444;"></strong>?
      </p>

      <div style="margin-bottom:16px;">
        <label for="deleteHandlerConfirmInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Type the handler name to confirm <span style="color:#ef4444;">*</span>
        </label>
        <input type="text" id="deleteHandlerConfirmInput" placeholder="Enter handler name to confirm" style="width:100%;">
      </div>

      <div style="display:flex;gap:12px;">
        <button id="confirmDeleteHandlerBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);" disabled>Delete Permanently</button>
        <button data-action="closeDeleteHandlerModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
      </div>

      <div id="deleteHandlerMsg" style="margin-top:12px;text-align:center;"></div>
    </div>
  </div>
</div>

<!-- Add/Edit Service Modal -->
<div id="serviceModal" class="modal-overlay">
  <div class="modal" style="max-width:700px;">
    <div class="modal-header">
      <h3 class="modal-title" id="serviceModalTitle">Add Service</h3>
      <button class="modal-close" data-action="closeServiceModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;">
        <div>
          <label for="serviceIdInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Service ID <span style="color:#ef4444;">*</span>
          </label>
          <input type="text" id="serviceIdInput" placeholder="e.g., stripe, github" style="width:100%;">
          <div style="font-size:0.75rem;color:var(--gray);margin-top:4px;">Lowercase alphanumeric with hyphens only</div>
        </div>
        <div>
          <label for="serviceNameInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Name <span style="color:#ef4444;">*</span>
          </label>
          <input type="text" id="serviceNameInput" placeholder="e.g., Stripe, GitHub" style="width:100%;">
        </div>
      </div>

      <div style="margin-top:16px;">
        <label for="serviceDescriptionInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Description <span style="color:#ef4444;">*</span>
        </label>
        <textarea id="serviceDescriptionInput" placeholder="Describe what this service does..." style="width:100%;min-height:80px;resize:vertical;"></textarea>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
        <div>
          <label for="serviceTypeInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Service Type <span style="color:#ef4444;">*</span>
          </label>
          <select id="serviceTypeInput" style="width:100%;padding:8px;">
            <option value="">Select type...</option>
            <option value="banking">Banking</option>
            <option value="messaging">Messaging</option>
            <option value="crypto">Crypto</option>
            <option value="authentication">Authentication</option>
            <option value="payments">Payments</option>
            <option value="storage">Storage</option>
            <option value="analytics">Analytics</option>
            <option value="identity">Identity</option>
            <option value="social">Social</option>
            <option value="productivity">Productivity</option>
            <option value="other">Other</option>
          </select>
        </div>
        <div>
          <label for="serviceStatusInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Status
          </label>
          <select id="serviceStatusInput" style="width:100%;padding:8px;">
            <option value="active">Active</option>
            <option value="coming-soon">Coming Soon</option>
            <option value="deprecated">Deprecated</option>
          </select>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
        <div>
          <label for="serviceWebsiteInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Website URL <span style="color:#ef4444;">*</span>
          </label>
          <input type="url" id="serviceWebsiteInput" placeholder="https://example.com" style="width:100%;">
        </div>
        <div>
          <label for="serviceConnectInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Connect URL
          </label>
          <input type="url" id="serviceConnectInput" placeholder="https://vault.vettid.dev/connect/..." style="width:100%;">
          <div style="font-size:0.75rem;color:var(--gray);margin-top:4px;">Link to connect via vault</div>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
        <div>
          <label for="serviceLogoInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Logo URL
          </label>
          <input type="url" id="serviceLogoInput" placeholder="https://example.com/logo.png" style="width:100%;">
        </div>
        <div>
          <label for="serviceDocsInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Documentation URL
          </label>
          <input type="url" id="serviceDocsInput" placeholder="https://docs.example.com" style="width:100%;">
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:16px;">
        <div>
          <label for="serviceSortOrderInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
            Sort Order
          </label>
          <input type="number" id="serviceSortOrderInput" placeholder="100" value="100" style="width:100%;">
          <div style="font-size:0.75rem;color:var(--gray);margin-top:4px;">Lower numbers appear first</div>
        </div>
        <div style="display:flex;align-items:center;padding-top:28px;">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="serviceFeaturedInput" style="width:18px;height:18px;">
            <span style="font-weight:600;">Featured Service</span>
          </label>
        </div>
      </div>

      <div style="margin-top:16px;">
        <label for="serviceRequiredDataInput" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">
          Required User Data
        </label>
        <input type="text" id="serviceRequiredDataInput" placeholder="email, phone, full_name (comma-separated)" style="width:100%;">
        <div style="font-size:0.75rem;color:var(--gray);margin-top:4px;">Data keys the user must provide to connect</div>
      </div>

      <div style="display:flex;gap:12px;margin-top:24px;">
        <button id="saveServiceBtn" class="btn" style="flex:1;background:linear-gradient(135deg,var(--accent) 0%,var(--accent-dark) 100%);">Save Service</button>
        <button data-action="closeServiceModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
      </div>

      <div id="serviceModalMsg" style="margin-top:12px;text-align:center;"></div>
    </div>
  </div>
</div>

<!-- Service Details Modal -->
<div id="serviceDetailsModal" class="modal-overlay">
  <div class="modal" style="max-width:700px;">
    <div class="modal-header">
      <h3 class="modal-title" id="serviceDetailName">Service Details</h3>
      <button class="modal-close" data-action="closeServiceDetailsModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="display:grid;grid-template-columns:auto 1fr;gap:8px 20px;margin-bottom:20px;">
        <span style="color:var(--gray);">ID:</span>
        <span id="serviceDetailId" style="font-family:monospace;"></span>
        <span style="color:var(--gray);">Type:</span>
        <span id="serviceDetailType"></span>
        <span style="color:var(--gray);">Status:</span>
        <span id="serviceDetailStatus" style="display:inline-block;padding:4px 10px;border-radius:4px;font-size:0.75rem;font-weight:700;text-transform:uppercase;"></span>
        <span style="color:var(--gray);">Connections:</span>
        <span id="serviceDetailConnections"></span>
        <span style="color:var(--gray);">Featured:</span>
        <span id="serviceDetailFeatured"></span>
        <span style="color:var(--gray);">Sort Order:</span>
        <span id="serviceDetailSortOrder"></span>
      </div>

      <div style="margin-bottom:20px;">
        <h4 style="margin:0 0 8px 0;font-size:0.9rem;color:var(--gray);">Description</h4>
        <p id="serviceDetailDescription" style="margin:0;"></p>
      </div>

      <div style="margin-bottom:20px;">
        <h4 style="margin:0 0 8px 0;font-size:0.9rem;color:var(--gray);">Links</h4>
        <div style="display:flex;flex-direction:column;gap:8px;">
          <div id="serviceDetailWebsiteRow"><span style="color:var(--gray);margin-right:8px;">Website:</span><a id="serviceDetailWebsite" href="#" target="_blank" style="color:var(--accent);"></a></div>
          <div id="serviceDetailConnectRow" style="display:none;"><span style="color:var(--gray);margin-right:8px;">Connect:</span><a id="serviceDetailConnect" href="#" target="_blank" style="color:var(--accent);"></a></div>
          <div id="serviceDetailDocsRow" style="display:none;"><span style="color:var(--gray);margin-right:8px;">Docs:</span><a id="serviceDetailDocs" href="#" target="_blank" style="color:var(--accent);"></a></div>
        </div>
      </div>

      <div id="serviceDetailRequiredDataSection" style="margin-bottom:20px;display:none;">
        <h4 style="margin:0 0 8px 0;font-size:0.9rem;color:var(--gray);">Required User Data</h4>
        <div id="serviceDetailRequiredData" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
      </div>

      <div style="margin-bottom:20px;">
        <h4 style="margin:0 0 8px 0;font-size:0.9rem;color:var(--gray);">Audit Trail</h4>
        <div style="display:grid;grid-template-columns:auto 1fr;gap:4px 20px;font-size:0.9rem;">
          <span style="color:var(--gray);">Created:</span>
          <span id="serviceDetailCreatedAt"></span>
          <span style="color:var(--gray);">Created by:</span>
          <span id="serviceDetailCreatedBy"></span>
          <span style="color:var(--gray);">Updated:</span>
          <span id="serviceDetailUpdatedAt"></span>
        </div>
      </div>

      <div style="display:flex;gap:12px;">
        <button id="editServiceBtn" class="btn" style="flex:1;background:linear-gradient(135deg,var(--accent) 0%,var(--accent-dark) 100%);">Edit Service</button>
        <button id="deleteServiceBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);">Delete Service</button>
        <button data-action="closeServiceDetailsModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Service Modal -->
<div id="deleteServiceModal" class="modal-overlay">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <h3 class="modal-title" style="color:#ef4444;">Delete Service</h3>
      <button class="modal-close" data-action="closeDeleteServiceModal">&times;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom:16px;color:var(--gray);">
        Are you sure you want to delete <strong id="deleteServiceName"></strong>? This action cannot be undone.
      </p>

      <div style="display:flex;gap:12px;">
        <button id="confirmDeleteServiceBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#ef4444 0%,#dc2626 100%);">Delete Service</button>
        <button data-action="closeDeleteServiceModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
      </div>

      <div id="deleteServiceMsg" style="margin-top:12px;text-align:center;"></div>
    </div>
  </div>
</div>

<!-- CSV Import Modal -->
<div id="csvImportModal" class="modal-overlay">
  <div class="modal" style="max-width:700px;">
    <div class="modal-header">
      <h3 class="modal-title">Batch Import Waitlist</h3>
      <button class="modal-close" data-action="closeCsvImportModal">&times;</button>
    </div>
    <div class="modal-body">
      <p style="margin-bottom:16px;color:var(--gray);font-size:0.9rem;">
        Upload a CSV file to bulk add users to the waitlist. The CSV should have columns: <strong>first_name</strong>, <strong>last_name</strong>, <strong>email</strong>.
      </p>

      <!-- File Upload -->
      <div style="margin-bottom:20px;">
        <label for="csvFileInput" style="display:block;margin-bottom:6px;font-size:0.9rem;color:var(--gray);">
          CSV File <span style="color:#ef4444;">*</span>
        </label>
        <input type="file" id="csvFileInput" accept=".csv" style="width:100%;" />
        <div style="font-size:0.8rem;color:var(--gray);margin-top:4px;">
          Example CSV format:<br/>
          <code style="background:var(--bg-tertiary);padding:4px 8px;border-radius:4px;display:block;margin-top:4px;">
            first_name,last_name,email<br/>
            John,Doe,john@example.com<br/>
            Jane,Smith,jane@example.com
          </code>
        </div>
      </div>

      <!-- Preview -->
      <div id="csvPreviewSection" style="display:none;margin-bottom:20px;">
        <h4 style="margin:0 0 12px 0;color:var(--accent);font-size:0.95rem;">Preview (<span id="csvRecordCount">0</span> records)</h4>
        <div style="max-height:300px;overflow-y:auto;background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:12px;">
          <table id="csvPreviewTable" style="width:100%;font-size:0.85rem;">
            <thead>
              <tr>
                <th style="text-align:left;padding:8px;border-bottom:1px solid var(--border);">First Name</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid var(--border);">Last Name</th>
                <th style="text-align:left;padding:8px;border-bottom:1px solid var(--border);">Email</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="csvValidationMsg" style="margin-top:8px;font-size:0.85rem;"></div>
      </div>

      <!-- Progress -->
      <div id="importProgressSection" style="display:none;margin-bottom:20px;">
        <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:6px;padding:16px;">
          <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
            <span style="font-size:0.9rem;color:var(--gray);">Importing...</span>
            <span id="importProgressText" style="font-size:0.9rem;font-weight:600;">0%</span>
          </div>
          <div style="background:var(--bg-tertiary);border-radius:4px;height:8px;overflow:hidden;">
            <div id="importProgressBar" style="background:linear-gradient(135deg,#10b981 0%,#059669 100%);height:100%;width:0%;transition:width 0.3s ease;"></div>
          </div>
          <div id="importResultMsg" style="margin-top:12px;font-size:0.85rem;"></div>
        </div>
      </div>

      <!-- Actions -->
      <div style="display:flex;gap:12px;">
        <button id="startImportBtn" class="btn" style="flex:1;background:linear-gradient(135deg,#10b981 0%,#059669 100%);" disabled>Import to Waitlist</button>
        <button data-action="closeCsvImportModal" class="btn" style="flex:1;background:var(--bg-button-secondary);">Cancel</button>
      </div>
    </div>
  </div>
</div>

<!-- Compose Email Modal -->
<div id="composeEmailModal" class="modal-overlay">
  <div class="modal" style="max-width:600px;">
    <div class="modal-header">
      <h3 class="modal-title">Compose Email</h3>
      <button class="modal-close" data-action="closeComposeEmailModal">&times;</button>
    </div>
    <div class="modal-body">
      <div style="margin-bottom:16px;">
        <label for="emailRecipientType" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">Recipients</label>
        <select id="emailRecipientType" style="width:100%;padding:10px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:0.95rem;">
          <option value="">Select recipient group...</option>
          <option value="waitlist">All Waitlisted Users</option>
          <option value="registered">All Registered Users</option>
          <option value="members">All Members</option>
          <option value="subscribers">All Subscribers</option>
        </select>
      </div>

      <div style="margin-bottom:16px;">
        <label for="emailSubject" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">Subject</label>
        <input type="text" id="emailSubject" placeholder="Enter email subject..." style="width:100%;padding:10px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:0.95rem;">
      </div>

      <div style="margin-bottom:16px;">
        <label for="emailBody" style="display:block;margin-bottom:6px;font-size:0.9rem;font-weight:600;">Message</label>
        <textarea id="emailBody" placeholder="Enter your message here... (HTML supported)" style="width:100%;padding:12px;background:var(--bg-input);border:1px solid var(--border);border-radius:4px;color:var(--text);font-size:0.95rem;min-height:180px;font-family:monospace;resize:vertical;"></textarea>
        <p class="muted" style="font-size:0.8rem;margin-top:6px;">Supports basic HTML: &lt;b&gt;, &lt;i&gt;, &lt;p&gt;, &lt;a&gt;</p>
      </div>

      <div style="display:flex;gap:12px;">
        <button id="sendBulkEmail" class="btn" style="flex:1;background:linear-gradient(135deg,#3b82f6 0%,#2563eb 100%);">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:middle;margin-right:6px;">
            <line x1="22" y1="2" x2="11" y2="13"></line>
            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
          </svg>
          Send Email
        </button>
        <button data-action="closeComposeEmailModal" class="btn" style="flex:1;background:linear-gradient(135deg,#7c3aed 0%,#6d28d9 100%);">Cancel</button>
      </div>
    </div>
  </div>
</div>

</body>
</html>
